import{Q as Z}from"./QSelect.70047d12.js";import{Q as X}from"./QSpinnerDots.6c974946.js";import{u as T}from"./quizStore.de5eab0d.js";import{r as h,w as U,o as $,X as f,a9 as p,a7 as s,q as i,Z as c,ae as O,a1 as g,$ as D,ad as Q,k as z,a5 as j,F as k,aa as I,a0 as R,Y as E,a4 as V}from"./index.037f850d.js";import{C as J}from"./auto.01ee0c75.js";import{d as K}from"./date.3d27e200.js";import{_ as F}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as W}from"./QLinearProgress.f467e272.js";import{Q as G,b as B,a as M}from"./QTable.3729fe60.js";import{Q as P}from"./QTr.671570e6.js";import"./rtl.ad3ba425.js";import"./QItem.a6e550b6.js";import"./selection.b5503321.js";import"./format.8ac60962.js";import"./QList.80fe3cd0.js";import"./QMarkupTable.c24125e0.js";import"./use-fullscreen.e9e81b6d.js";const ee={name:"QuizReportLevel",props:{course:{type:String,required:!0},level:{type:String,required:!0}},setup(m){const o=T(),u=h(null),e=h(null),_=h(null),x=h(null),r=t=>{if(!(t!=null&&t.validData))return null;const l=[];return Object.entries(t.validData).forEach(([d,n])=>{var y,S;(S=(y=n[m.course])==null?void 0:y[m.level])!=null&&S.tests&&n[m.course][m.level].tests.forEach(C=>{var q,w;l.push({timestamp:C.timestamp,score:((q=C.score)==null?void 0:q.percentage)||0,studentName:((w=C.studentInfo)==null?void 0:w.name)||"Unknown Student"})})}),l.sort((d,n)=>new Date(d.timestamp)-new Date(n.timestamp)),l.length>0&&(_.value=l.reduce((d,n)=>n.score>d.score?n:d,l[0]),x.value=l.reduce((d,n)=>n.score<d.score?n:d,l[0])),l},v=t=>{if(!u.value||!t)return;const l=u.value.getContext("2d");e.value&&e.value.destroy(),e.value=new J(l,{type:"line",data:{labels:t.map(d=>b(d.timestamp)),datasets:[{label:"Score Percentage",data:t.map(d=>d.score),borderColor:"#1976D2",backgroundColor:"rgba(25, 118, 210, 0.1)",fill:!0,pointStyle:"circle",pointRadius:6,pointHoverRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:d=>{const n=t[d.dataIndex];return[`Score: ${n.score}%`,`Student: ${n.studentName}`]}}}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Score (%)"}},x:{title:{display:!0,text:"Test Date"}}}}})},b=t=>K.formatDate(t,"YYYY-MM-DD"),a=async()=>{const t=await o.getQuizResultByCourseInfo(),l=r(t);l&&v(l)};return U([()=>m.course,()=>m.level],()=>{a()}),$(()=>{a()}),{chartCanvas:u,highestScore:_,lowestScore:x,formatDate:b}}},te={class:"q-pa-md"},oe={class:"row q-col-gutter-md"},se={class:"col-12",style:{height:"400px"}},ae={ref:"chartCanvas"},le={class:"col-12 col-md-6 q-mt-md"},re={key:0,class:"row items-center q-mt-sm"},ne={class:"text-h5 text-positive"},ce={class:"q-ml-md"},ie={class:"text-caption"},de={class:"col-12 col-md-6 q-mt-md"},ue={key:0,class:"row items-center q-mt-sm"},ve={class:"text-h5 text-negative"},me={class:"q-ml-md"},fe={class:"text-caption"};function _e(m,o,u,e,_,x){return f(),p("div",te,[o[2]||(o[2]=s("div",{class:"text-h6 q-mb-md"},"Level Performance Report",-1)),s("div",oe,[s("div",se,[s("canvas",ae,null,512)]),s("div",le,[i(Q,null,{default:c(()=>[i(O,null,{default:c(()=>[o[0]||(o[0]=s("div",{class:"text-subtitle1"},"Highest Score",-1)),e.highestScore?(f(),p("div",re,[s("div",ne,g(e.highestScore.score)+"%",1),s("div",ce,[s("div",null,g(e.highestScore.studentName),1),s("div",ie,g(e.formatDate(e.highestScore.timestamp)),1)])])):D("",!0)]),_:1})]),_:1})]),s("div",de,[i(Q,null,{default:c(()=>[i(O,null,{default:c(()=>[o[1]||(o[1]=s("div",{class:"text-subtitle1"},"Lowest Score",-1)),e.lowestScore?(f(),p("div",ue,[s("div",ve,g(e.lowestScore.score)+"%",1),s("div",me,[s("div",null,g(e.lowestScore.studentName),1),s("div",fe,g(e.formatDate(e.lowestScore.timestamp)),1)])])):D("",!0)]),_:1})]),_:1})])])])}var ge=F(ee,[["render",_e]]);const pe={name:"QuizReportAverage",props:{course:{type:String,required:!0},level:{type:String,required:!0}},setup(m){const o=T(),u=h([]),e=t=>{if(!(t!=null&&t.validData))return[];const l=[];return Object.values(t.validData).forEach(d=>{var n,y;(y=(n=d[m.course])==null?void 0:n[m.level])!=null&&y.tests&&d[m.course][m.level].tests.forEach(S=>{var C;(C=S.score)!=null&&C.percentage&&l.push(S.score.percentage)})}),l},_=z(()=>u.value.length===0?0:u.value.reduce((t,l)=>t+l,0)/u.value.length),x=z(()=>_.value>=80?"text-positive":_.value>=60?"text-warning":"text-negative"),r=z(()=>u.value.length),v=z(()=>u.value.length===0?0:u.value.filter(l=>l>=60).length/u.value.length*100),b=z(()=>{const t=[{min:80,max:100,label:"Excellent (80-100)",color:"positive",count:0},{min:60,max:79,label:"Good (60-79)",color:"warning",count:0},{min:40,max:59,label:"Fair (40-59)",color:"orange",count:0},{min:0,max:39,label:"Poor (0-39)",color:"negative",count:0}];return u.value.forEach(l=>{const d=t.find(n=>l>=n.min&&l<=n.max);d&&d.count++}),t.forEach(l=>{l.percentage=l.count/u.value.length*100||0}),t}),a=async()=>{const t=await o.getQuizResultByCourseInfo();u.value=e(t)};return U([()=>m.course,()=>m.level],()=>{a()}),a(),{averageScore:_,averageScoreColor:x,totalStudents:r,passRate:v,scoreRanges:b}}},ye={class:"q-pa-md"},he={class:"row items-center q-mt-md"},xe={class:"col-12 col-md-4"},be={class:"col-12 col-md-8"},we={class:"row q-col-gutter-md"},Se={class:"col-6"},Ce={class:"text-h5"},qe={class:"col-6"},Oe={class:"text-h5"},Qe={class:"q-mt-lg"},ke={class:"row q-col-gutter-sm"},Re={class:"text-caption"},Ne={class:"text-h6"};function ze(m,o,u,e,_,x){return f(),p("div",ye,[i(Q,{class:"average-report"},{default:c(()=>[i(O,null,{default:c(()=>[o[4]||(o[4]=s("div",{class:"text-h6"},"Level Average Performance",-1)),s("div",he,[s("div",xe,[o[0]||(o[0]=s("div",{class:"text-subtitle2"},"Overall Average",-1)),s("div",{class:j(["text-h3",e.averageScoreColor])},g(e.averageScore.toFixed(1))+"% ",3)]),s("div",be,[s("div",we,[s("div",Se,[i(Q,{flat:"",bordered:""},{default:c(()=>[i(O,null,{default:c(()=>[o[1]||(o[1]=s("div",{class:"text-subtitle2"},"Total Students",-1)),s("div",Ce,g(e.totalStudents),1)]),_:1})]),_:1})]),s("div",qe,[i(Q,{flat:"",bordered:""},{default:c(()=>[i(O,null,{default:c(()=>[o[2]||(o[2]=s("div",{class:"text-subtitle2"},"Pass Rate",-1)),s("div",Oe,g(e.passRate.toFixed(1))+"%",1)]),_:1})]),_:1})])])])]),s("div",Qe,[o[3]||(o[3]=s("div",{class:"text-subtitle2 q-mb-sm"},"Score Distribution",-1)),s("div",ke,[(f(!0),p(k,null,I(e.scoreRanges,(r,v)=>(f(),p("div",{key:v,class:"col-12 col-md-3"},[i(Q,{flat:"",bordered:""},{default:c(()=>[i(O,null,{default:c(()=>[s("div",Re,g(r.label),1),s("div",Ne,g(r.count),1),i(W,{value:r.percentage/100,color:r.color,class:"q-mt-sm"},null,8,["value","color"])]),_:2},1024)]),_:2},1024)]))),128))])])]),_:1})]),_:1})])}var Ee=F(pe,[["render",ze],["__scopeId","data-v-d1bf6348"]]);const Ae={name:"OverviewTable",props:{course:{type:String,required:!0}},setup(m){const o=T(),u=h(!1),e=h([]),_=h([]),x=t=>{if(!(t!=null&&t.validData))return;const l=new Map,d=new Set;Object.values(t.validData).forEach(n=>{const y=n[m.course];!y||(Object.keys(y).forEach(S=>d.add(S)),Object.entries(y).forEach(([S,C])=>{C.tests.forEach(q=>{var A,L,H;const w=(A=q.studentInfo)==null?void 0:A.studentId,N=(L=q.studentInfo)==null?void 0:L.name;if(!w||!N)return;l.has(w)||l.set(w,{studentId:w,studentName:N,scores:{}});const Y=l.get(w);Y.scores[S]=((H=q.score)==null?void 0:H.percentage)||null})}))}),_.value=Array.from(d).sort(),e.value=Array.from(l.values()).sort((n,y)=>n.studentName.localeCompare(y.studentName))},r=z(()=>[{name:"studentName",label:"Student Name",field:"studentName",align:"left",sortable:!0},..._.value.map(t=>({name:t,label:t,field:l=>l.scores[t],align:"center",sortable:!0}))]),v=t=>t==null?"text-grey":t>=80?"text-positive":t>=60?"text-warning":"text-negative",b=t=>t==null?"-":`${t.toFixed(1)}%`,a=async()=>{try{u.value=!0;const t=await o.getQuizResultByCourseInfo();x(t)}catch(t){console.error("Error loading overview data:",t)}finally{u.value=!1}};return U(()=>m.course,()=>{a()}),a(),{loading:u,tableData:e,columns:r,levels:_,getScoreClass:v,formatScore:b}}},Le={class:"q-pa-md"},De={class:"text-h6 q-mb-md"};function Ie(m,o,u,e,_,x){return f(),p("div",Le,[i(Q,null,{default:c(()=>[i(O,null,{default:c(()=>[s("div",De,"Course Overview: "+g(u.course),1),i(G,{rows:e.tableData,columns:e.columns,"row-key":"studentId",loading:e.loading,flat:"",bordered:"",class:"overview-table"},{header:c(r=>[i(P,{props:r},{default:c(()=>[i(B,{class:"student-name-column"},{default:c(()=>o[0]||(o[0]=[R("Student Name")])),_:1}),(f(!0),p(k,null,I(e.levels,v=>(f(),E(B,{key:v,class:"level-column"},{default:c(()=>[R(g(v),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),body:c(r=>[i(P,{props:r},{default:c(()=>[i(M,{class:"student-name-column"},{default:c(()=>[R(g(r.row.studentName),1)]),_:2},1024),(f(!0),p(k,null,I(e.levels,v=>(f(),E(M,{key:v,class:j(["level-column",e.getScoreClass(r.row.scores[v])])},{default:c(()=>[R(g(e.formatScore(r.row.scores[v])),1)]),_:2},1032,["class"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})])}var Te=F(Ae,[["render",Ie],["__scopeId","data-v-92179d2e"]]);const Fe={name:"OverviewCompany",setup(){const m=T(),o=h(!1),u=h([]),e=h([]),_=a=>{if(!(a!=null&&a.validData))return;const t=new Map,l=new Set;Object.values(a.validData).forEach(d=>{Object.entries(d).forEach(([n,y])=>{l.add(n),Object.entries(y).forEach(([S,C])=>{C.tests.forEach(q=>{var A,L;const w=(A=q.classInfo)==null?void 0:A.company;if(!w)return;t.has(w)||t.set(w,{companyName:w,averages:{}});const N=t.get(w);N.averages[n]||(N.averages[n]={totalScore:0,count:0,average:0});const Y=((L=q.score)==null?void 0:L.percentage)||0;N.averages[n].totalScore+=Y,N.averages[n].count+=1})})})}),t.forEach(d=>{Object.keys(d.averages).forEach(n=>{const y=d.averages[n];y.count>0?y.average=y.totalScore/y.count:d.averages[n]=null})}),e.value=Array.from(l).sort(),u.value=Array.from(t.values()).sort((d,n)=>d.companyName.localeCompare(n.companyName))},x=z(()=>[{name:"companyName",label:"Company Name",field:"companyName",align:"left",sortable:!0},...e.value.map(a=>({name:a,label:a,field:t=>t.averages[a],align:"center",sortable:!0}))]),r=a=>a==null?"text-grey":a>=80?"text-positive":a>=60?"text-warning":"text-negative",v=a=>a==null?"-":`${a.toFixed(1)}%`,b=async()=>{try{o.value=!0;const a=await m.getQuizResultByCourseInfo();_(a)}catch(a){console.error("Error loading company overview data:",a)}finally{o.value=!1}};return $(()=>{b()}),{loading:o,tableData:u,columns:x,courses:e,getAverageClass:r,formatAverage:v}}},Ve={class:"q-pa-md"},je={class:"text-caption text-grey-7"};function Be(m,o,u,e,_,x){return f(),p("div",Ve,[i(Q,null,{default:c(()=>[i(O,null,{default:c(()=>[o[1]||(o[1]=s("div",{class:"text-h6 q-mb-md"},"Company Overview",-1)),i(G,{rows:e.tableData,columns:e.columns,"row-key":"companyName",loading:e.loading,flat:"",bordered:"",class:"overview-table"},{header:c(r=>[i(P,{props:r},{default:c(()=>[i(B,{class:"company-name-column"},{default:c(()=>o[0]||(o[0]=[R("Company Name")])),_:1}),(f(!0),p(k,null,I(e.courses,v=>(f(),E(B,{key:v,class:"course-column"},{default:c(()=>[R(g(v),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),body:c(r=>[i(P,{props:r},{default:c(()=>[i(M,{class:"company-name-column"},{default:c(()=>[R(g(r.row.companyName),1)]),_:2},1024),(f(!0),p(k,null,I(e.courses,v=>{var b;return f(),E(M,{key:v,class:j(["course-column",e.getAverageClass((b=r.row.averages[v])==null?void 0:b.average)])},{default:c(()=>[r.row.averages[v]?(f(),p(k,{key:0},[s("div",{class:j(e.getAverageClass(r.row.averages[v].average))},g(e.formatAverage(r.row.averages[v].average)),3),s("div",je,g(r.row.averages[v].count)+" students ",1)],64)):(f(),p(k,{key:1},[R("-")],64))]),_:2},1032,["class"])}),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1})])}var Me=F(Fe,[["render",Be],["__scopeId","data-v-9951e620"]]);const Pe={components:{QuizReportLevel:ge,QuizReportAverage:Ee,OverviewTable:Te,OverviewCompany:Me},setup(){const m=T(),o=h(""),u=h(""),e=h(!1),_=h(null),x=h([]),r=h([]),v=async()=>{try{e.value=!0,_.value=null;const a=await m.fetchFilterOptions();x.value=a.courseOptions,r.value=a.levelOptions}catch(a){_.value="Failed to load filter options: "+a.message,console.error("Error loading filter options:",a)}finally{e.value=!1}},b=()=>{u.value=""};return $(async()=>{await v()}),{selectedCourse:o,selectedLevel:u,loading:e,error:_,courseOptions:x,levelOptions:r,handleCourseChange:b}}},Ye={class:"row q-col-gutter-md q-mb-lg"},Ue={class:"col-12 col-md-6"},$e={class:"col-12 col-md-6"},He={key:0,class:"text-center q-pa-md"},Ze={key:1,class:"text-negative q-pa-md"},Ge={key:5,class:"text-center q-pa-xl text-grey-7"};function Xe(m,o,u,e,_,x){const r=V("OverviewCompany"),v=V("OverviewTable"),b=V("QuizReportAverage"),a=V("QuizReportLevel");return f(),p("div",null,[o[3]||(o[3]=s("div",{class:"text-h5 q-mb-md"},"Quiz Report",-1)),s("div",Ye,[s("div",Ue,[i(Z,{modelValue:e.selectedCourse,"onUpdate:modelValue":o[0]||(o[0]=t=>e.selectedCourse=t),options:e.courseOptions,label:"Select Course",outlined:"",loading:e.loading,"emit-value":"","map-options":""},null,8,["modelValue","options","loading"])]),s("div",$e,[i(Z,{modelValue:e.selectedLevel,"onUpdate:modelValue":o[1]||(o[1]=t=>e.selectedLevel=t),options:e.levelOptions,label:"Select Level",outlined:"",loading:e.loading,"emit-value":"","map-options":"",disable:!e.selectedCourse},null,8,["modelValue","options","loading","disable"])])]),e.loading?(f(),p("div",He,[i(X,{color:"primary",size:"40px"}),o[2]||(o[2]=s("div",{class:"text-body1 q-mt-sm"},"Loading report data...",-1))])):e.error?(f(),p("div",Ze,g(e.error),1)):D("",!0),e.selectedCourse?(f(),E(r,{key:2,course:e.selectedCourse},null,8,["course"])):D("",!0),e.selectedCourse?(f(),E(v,{key:3,course:e.selectedCourse},null,8,["course"])):D("",!0),e.selectedCourse&&e.selectedLevel?(f(),p(k,{key:4},[i(b,{course:e.selectedCourse,level:e.selectedLevel},null,8,["course","level"]),i(a,{course:e.selectedCourse,level:e.selectedLevel},null,8,["course","level"])],64)):(f(),p("div",Ge," Please select a course to view the overview "))])}var ft=F(Pe,[["render",Xe]]);export{ft as default};
