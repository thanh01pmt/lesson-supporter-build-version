import{Q as De}from"./QPage.a2da79f2.js";import{k as p,y as he,l as Be,i as L,a6 as u,ap as xe,cc as ye,_ as Ce,R as Se,p as Le,D as Me,G as je,r as i,aL as Oe,J as Re,O as ze,z as Ke,h as we,W as Ne,w as ce,bv as We,aE as He,bw as Je,o as Xe,m as Ge,a4 as ke,X as S,a9 as V,q as n,Z as l,ad as x,ae as T,L as M,ac as Y,a7 as y,F as Z,aa as ee,Y as R,c9 as Ye,a1 as j,ag as ue,$ as Ze,bs as me,a5 as et,aH as tt}from"./index.037f850d.js";import{Q as nt,a as ot}from"./QCarousel.3525bb9c.js";import{Q as ge}from"./QPageSticky.881935b1.js";import{Q as lt}from"./QSpace.8ac92afd.js";import{Q as at,a as te,b as st,c as it}from"./QTabPanels.d3e13bfb.js";import{Q as rt}from"./QImg.c60a9877.js";import{Q as dt}from"./QSpinnerTail.4d1e37ab.js";import{C as O}from"./ClosePopup.f7b4fda5.js";import fe from"./IntroductionSlide-Sach.c9ebc073.js";import ne from"./ContentSlide-Sach.c6b82a0e.js";import pe from"./ExerciseSlide-Sach.429c5d63.js";import be from"./SummarySlide-Sach.0189ce01.js";import ve from"./AssessmentSlide-Sach.b1f53ce4.js";import{L as ct}from"./LessonContentShortener.b62a2d70.js";import{u as ut}from"./use-quasar.414eeb3f.js";import{_ as Ie}from"./plugin-vue_export-helper.21dcd24c.js";import{l as mt}from"./lessonPlanSample-Sach.5074cbc5.js";import"./use-fullscreen.e9e81b6d.js";import"./QResizeObserver.b97c3070.js";import"./rtl.ad3ba425.js";import"./touch.9135741d.js";import"./selection.b5503321.js";import"./use-render-cache.3aae9b27.js";import"./SlideFooter-Sach.64da771b.js";import"./SlideHeader-Sach.594420a5.js";import"./marked.esm.ee94f6d8.js";import"./QSelect.70047d12.js";import"./QItem.a6e550b6.js";import"./format.8ac60962.js";import"./QList.80fe3cd0.js";import"./QScrollObserver.61ed4524.js";import"./TouchPan.22ef2431.js";import"./googleAIService.c307673a.js";const gt=["top","right","bottom","left"],le={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:e=>gt.includes(e)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function _e(e,t){return{formClass:p(()=>`q-fab--form-${e.square===!0?"square":"rounded"}`),stacked:p(()=>e.externalLabel===!1&&["top","bottom"].includes(e.labelPosition)),labelProps:p(()=>{if(e.externalLabel===!0){const m=e.hideLabel===null?t.value===!1:e.hideLabel;return{action:"push",data:{class:[e.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${e.labelPosition}`+(m===!0?" q-fab__label--external-hidden":"")],style:e.labelStyle}}}return{action:["left","top"].includes(e.labelPosition)?"unshift":"push",data:{class:[e.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${e.labelPosition}`+(e.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:e.labelStyle}}})}}const $e={start:"self-end",center:"self-center",end:"self-start"},ft=Object.keys($e);var oe=he({name:"QFabAction",props:{...le,icon:{type:String,default:""},anchor:{type:String,validator:e=>ft.includes(e)},to:[String,Object],replace:Boolean},emits:["click"],setup(e,{slots:t,emit:m}){const r=Be(ye,()=>({showing:{value:!0},onChildClick:xe})),{formClass:k,labelProps:C}=_e(e,r.showing),b=p(()=>{const d=$e[e.anchor];return k.value+(d!==void 0?` ${d}`:"")}),o=p(()=>e.disable===!0||r.showing.value!==!0);function s(d){r.onChildClick(d),m("click",d)}function g(){const d=[];return t.icon!==void 0?d.push(t.icon()):e.icon!==""&&d.push(L(Ce,{name:e.icon})),(e.label!==""||t.label!==void 0)&&d[C.value.action](L("div",C.value.data,t.label!==void 0?t.label():[e.label])),Se(t.default,d)}const q=Le();return Object.assign(q.proxy,{click:s}),()=>L(u,{class:b.value,...e,noWrap:!0,stack:e.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:o.value,onClick:s},g)}});const pt=["up","right","down","left"],bt=["left","center","right"];var vt=he({name:"QFab",props:{...le,...Me,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...le.hideLabel,default:null},direction:{type:String,default:"right",validator:e=>pt.includes(e)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:e=>bt.includes(e)}},emits:je,setup(e,{slots:t}){const m=i(null),r=i(e.modelValue===!0),k=Oe(),{proxy:{$q:C}}=Le(),{formClass:b,labelProps:o}=_e(e,r),s=p(()=>e.persistent!==!0),{hide:g,toggle:q}=Re({showing:r,hideOnRouteChange:s}),d=p(()=>({opened:r.value})),P=p(()=>`q-fab z-fab row inline justify-center q-fab--align-${e.verticalActionsAlign} ${b.value}`+(r.value===!0?" q-fab--opened":" q-fab--closed")),z=p(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${e.direction} q-fab__actions--${r.value===!0?"opened":"closed"}`),K=p(()=>{const c={id:k.value,role:"menu"};return r.value!==!0&&(c["aria-hidden"]="true"),c}),A=p(()=>`q-fab__icon-holder  q-fab__icon-holder--${r.value===!0?"opened":"closed"}`);function F(c,I){const U=t[c],Q=`q-fab__${c} absolute-full`;return U===void 0?L(Ce,{class:Q,name:e[I]||C.iconSet.fab[I]}):L("div",{class:Q},U(d.value))}function N(){const c=[];return e.hideIcon!==!0&&c.push(L("div",{class:A.value},[F("icon","icon"),F("active-icon","activeIcon")])),(e.label!==""||t.label!==void 0)&&c[o.value.action](L("div",o.value.data,t.label!==void 0?t.label(d.value):[e.label])),Se(t.tooltip,c)}return ze(ye,{showing:r,onChildClick(c){var I;g(c),(c==null?void 0:c.qAvoidFocus)!==!0&&((I=m.value)==null||I.$el.focus())}}),()=>L("div",{class:P.value},[L(u,{ref:m,class:b.value,...e,noWrap:!0,stack:e.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":r.value===!0?"true":"false","aria-haspopup":"true","aria-controls":k.value,onClick:q},N),L("div",{class:z.value,...K.value},Ke(t.default))])}});const ht=we({name:"SlideComponent",components:{IntroductionSlide:fe,ContentSlide:ne,ExerciseSlide:pe,SummarySlide:be,AssessmentSlide:ve,LessonContentShortener:ct},props:{activities:{type:Array,required:!0}},setup(e){const t=i(0),m=i(!1),r=i(null),k=Ne(),C=i(!1),b=i(!1),o=i(!1),s=i(new Map),g=i({content:localStorage.getItem("contentLayout")||"full",exercise:localStorage.getItem("exerciseLayout")||"exercise-standard",assessment:localStorage.getItem("assessmentLayout")||"assessment-standard",introduction:localStorage.getItem("introductionLayout")||"intro-standard",summary:localStorage.getItem("summaryLayout")||"summary-standard"}),q=a=>{console.log("Received content update:",a);const{slideType:f,content:v,slideId:h,objectType:w}=a;if(["introduction","assessment","content","exercise","summary"].includes(f)){const _=`${f}-${h}`;s.value.set(_,{content:v,slideType:f,slideId:h,objectType:w}),localStorage.setItem(`slide-${_}`,JSON.stringify({content:v,slideType:f,slideId:h,objectType:w}))}},d=i("16:9"),P=i(!1),z=i("content"),K=i({content:[{name:"full",label:"Full Image",description:"Image takes full slide, title at bottom",image:"public/image/Layout/full-image.png"},{name:"split",label:"Split View",description:"Image on left, title on right",image:"public/image/Layout/side-by-side.png"},{name:"compact",label:"Compact",description:"Small image with title below",image:"public/image/Layout/small-image.png"}],exercise:[{name:"exercise-standard",label:"Standard Exercise",description:"Challenge box on top, images below",image:"public/image/Layout/standart.png"},{name:"exercise-vertical",label:"Vertical Exercise",description:"Challenge box on left, images on right",image:"public/image/Layout/vertical.png"},{name:"exercise-centered",label:"Centered Exercise",description:"Challenge box in center, images around",image:"public/image/Layout/centered.png"}],assessment:[{name:"assessment-standard",label:"Standard Assessment",description:"Icon on left, content on right",image:"public/image/Layout/standard-assessment.png"},{name:"assessment-compact",label:"Compact Assessment",description:"Icon and content side by side, glossaries below",image:"public/image/Layout/compact-assessment.png"}]}),A=()=>{t.value<e.activities.length-1&&t.value++},F=()=>{t.value>0&&t.value--},N=()=>{t.value=0},c=()=>{t.value=e.activities.length-1},I=()=>{document.fullscreenElement?document.exitFullscreen():r.value.requestFullscreen()},U=()=>{b.value=!b.value,document.body.classList.toggle("dark-theme",b.value)},Q=()=>{m.value=!!document.fullscreenElement},ae=a=>{a.key==="ArrowRight"?A():a.key==="ArrowLeft"&&F()},Te=()=>{C.value=!0,setTimeout(()=>{k.push("/"),C.value=!1},2e3)},qe=a=>{switch(a.activityContent.contentSlide.slideType.toLowerCase()){case"introduction":return fe;case"content":return ne;case"exercise":return pe;case"summary":return be;case"assessment":return ve;default:return ne}},W=()=>{o.value=window.innerWidth<=480,console.log("isMobile:",o.value)},Ve=(a,f)=>{g.value[f]=a,localStorage.setItem(`${f}Layout`,a),d.value="16:9",P.value=!1};ce(g,a=>{localStorage.setItem("contentLayout",a.content),localStorage.setItem("exerciseLayout",a.exercise),localStorage.setItem("assessmentLayout",a.assessment),localStorage.setItem("introductionLayout",a.introduction),localStorage.setItem("summaryLayout",a.summary)}),ce(s,a=>{console.log("updatedContents changed to:",a)});const Fe=i(!1),Qe=a=>{const f=a.activityContent.contentSlide.slideType.toLowerCase(),v=a.activityContent.contentSlide.slideId,h=`${f}-${v}`,w=s.value.get(h);return(w==null?void 0:w.content)||""},se=We(),E=He(),D=Je(),H=ut(),J=i(!1),X=i(!1),ie=i(""),B=i(""),re=p(()=>s.value.size>0),Ee=()=>{if(!re.value){H.notify({type:"warning",message:"Kh\xF4ng c\xF3 n\u1ED9i dung n\xE0o \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt",position:"top"});return}B.value=E.lessonCode,J.value=!0},Pe=async()=>{var a,f,v,h,w;try{if(!((f=(a=D.user)==null?void 0:a.role)!=null&&f.includes("editor"))&&!((h=(v=D.user)==null?void 0:v.role)!=null&&h.includes("admin")))throw new Error("B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n th\u1EF1c hi\u1EC7n thao t\xE1c n\xE0y");if(console.log("Entered lesson code:",B.value),console.log("Current lesson code:",E.lessonCode),B.value.trim()!==E.lessonCode.trim())throw new Error("M\xE3 b\xE0i h\u1ECDc kh\xF4ng kh\u1EDBp");X.value=!0;const _={lessonTitle:((w=E.lessonPlan)==null?void 0:w.lessonTitle)||"Untitled Lesson",lessonSections:e.activities.map($=>{const G=$.activityContent.contentSlide.slideType.toLowerCase(),Ae=$.activityContent.contentSlide.slideId,Ue=`${G}-${Ae}`,de=s.value.get(Ue);return de?{...$,activityContent:{...$.activityContent,contentSlide:{...$.activityContent.contentSlide,contentText:de.content}}}:$})};await se.preparePackage(E.lessonCode,"lessonSlide",ie.value,{name:D.user.name,uid:D.user.uid},_),await se.pushPackageToFirestore(),s.value.forEach(($,G)=>{localStorage.removeItem(`slide-${G}`)}),s.value.clear(),J.value=!1,H.notify({type:"positive",message:"\u0110\xE3 \u0111\u1EA9y d\u1EEF li\u1EC7u l\xEAn Firebase th\xE0nh c\xF4ng!",position:"top"})}catch(_){console.error("L\u1ED7i khi \u0111\u1EA9y l\xEAn Firebase:",_),H.notify({type:"negative",message:_.message||"C\xF3 l\u1ED7i x\u1EA3y ra khi \u0111\u1EA9y d\u1EEF li\u1EC7u l\xEAn Firebase",position:"top"})}finally{X.value=!1}};return Xe(()=>{document.addEventListener("fullscreenchange",Q),document.addEventListener("keydown",ae),W(),window.addEventListener("resize",W),(()=>{Object.keys(localStorage).filter(v=>v.startsWith("slide-")).forEach(v=>{const h=JSON.parse(localStorage.getItem(v));h&&s.value.set(v.replace("slide-",""),h)})})()}),Ge(()=>{document.removeEventListener("fullscreenchange",Q),document.removeEventListener("keydown",ae),window.removeEventListener("resize",W)}),{slide:t,nextSlide:A,previousSlide:F,isFullscreen:m,toggleFullscreen:I,fullscreenElement:r,goToHome:Te,goToFirstSlide:N,goToLastSlide:c,getSlideComponent:qe,loading:C,toggleTheme:U,selectLayout:Ve,currentLayout:g,aspectRatio:d,showLayoutDialog:P,layouts:K,activeLayoutTab:z,updatedContents:s,getUpdateContentForSlide:Qe,handleContentShortened:q,showContentEditor:Fe,pushDialog:J,isUploading:X,updateDescription:ie,confirmLessonCode:B,hasUpdatedContent:re,showPushDialog:Ee,confirmPushToFirestore:Pe}}}),yt={class:"full-height full-width flex flex-center"},Ct={class:"custom-navigation"},St={class:"slide-indicator"},Lt={class:"column q-gutter-sm"},wt={class:"row q-col-gutter-md"},kt={class:"text-subtitle2"},It={class:"text-caption"},_t={key:0,class:"overlay"};function $t(e,t,m,r,k,C){const b=ke("lesson-content-shortener");return S(),V("div",null,[n(Y,{modelValue:e.showContentEditor,"onUpdate:modelValue":t[0]||(t[0]=o=>e.showContentEditor=o),style:{"background-color":""}},{default:l(()=>[n(x,{style:{width:"1200px","max-width":"90vw"}},{default:l(()=>[n(T,{style:{display:"flex","justify-content":"flex-end",margin:"0","padding-bottom":"0"}},{default:l(()=>[M(n(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1}),n(T,null,{default:l(()=>[n(b,{onContentShortened:e.handleContentShortened},null,8,["onContentShortened"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",{class:et(["slide-component",{fullscreen:e.isFullscreen}]),ref:"fullscreenElement"},[n(ot,{modelValue:e.slide,"onUpdate:modelValue":t[1]||(t[1]=o=>e.slide=o),"transition-prev":"slide-right","transition-next":"slide-left",swipeable:"",animated:"","control-color":"primary","navigation-icon":"radio_button_unchecked","navigation-active-icon":"lens",padding:"",class:"bg-white rounded-borders full-height"},{control:l(()=>[n(u,{round:"",dense:"",color:"primary","text-color":"white",icon:"chevron_left",onClick:e.previousSlide,disable:e.slide===0||e.isMobile,class:"side-nav-btn left-nav-btn"},null,8,["onClick","disable"]),n(u,{round:"",dense:"",color:"primary","text-color":"white",icon:"chevron_right",onClick:e.nextSlide,disable:e.slide===e.activities.length-1||e.isMobile,class:"side-nav-btn right-nav-btn"},null,8,["onClick","disable"])]),default:l(()=>[(S(!0),V(Z,null,ee(e.activities,(o,s)=>(S(),R(nt,{key:s,name:s,class:"column no-wrap"},{default:l(()=>[y("div",yt,[(S(),R(Ye(e.getSlideComponent(o)),{activity:o,updateContent:e.getUpdateContentForSlide(o),slideId:o.activityContent.contentSlide.slideId,"aspect-ratio":e.aspectRatio,layout:o.activityContent.contentSlide.slideType.toLowerCase()==="exercise"?e.currentLayout.exercise:o.activityContent.contentSlide.slideType.toLowerCase()==="assessment"?e.currentLayout.assessment:o.activityContent.contentSlide.slideType.toLowerCase()==="introduction"?e.currentLayout.introduction:e.currentLayout.content},null,8,["activity","updateContent","slideId","aspect-ratio","layout"]))])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),y("div",Ct,[n(u,{flat:"",round:"",color:"primary",icon:"first_page",onClick:e.goToFirstSlide,class:"navigation-btn"},null,8,["onClick"]),n(u,{flat:"",round:"",color:"primary",icon:"chevron_left",onClick:e.previousSlide,disable:e.slide===0,class:"navigation-btn"},null,8,["onClick","disable"]),y("div",St,j(e.slide+1)+" / "+j(e.activities.length),1),n(u,{flat:"",round:"",color:"primary",icon:"chevron_right",onClick:e.nextSlide,disable:e.slide===e.activities.length-1,class:"navigation-btn"},null,8,["onClick","disable"]),n(u,{flat:"",round:"",color:"primary",icon:"last_page",onClick:e.goToLastSlide,class:"navigation-btn"},null,8,["onClick"])]),n(ge,{position:"bottom-right",offset:[18,18]},{default:l(()=>[n(u,{fab:"",icon:e.isFullscreen?"fullscreen_exit":"fullscreen",color:"primary",onClick:e.toggleFullscreen,class:"fullscreen-btn"},null,8,["icon","onClick"])]),_:1}),n(ge,{position:"top-left",offset:[18,18]},{default:l(()=>[y("div",Lt,[n(vt,{modelValue:e.fab2,"onUpdate:modelValue":t[4]||(t[4]=o=>e.fab2=o),label:"","label-position":"right","external-label":"",color:"blue",icon:"settings",direction:"down"},{default:l(()=>[n(oe,{"external-label":"","label-position":"right",color:"primary",onClick:t[2]||(t[2]=o=>e.showLayoutDialog=!0),icon:"dashboard",label:"Layout"}),n(oe,{"external-label":"","label-position":"right",color:"secondary",onClick:e.showPushDialog,loading:e.isUploading,disable:!e.hasUpdatedContent,icon:"backup",label:"Push to Firestore"},null,8,["onClick","loading","disable"]),n(oe,{"external-label":"","label-position":"right",color:"orange",onClick:t[3]||(t[3]=o=>e.showContentEditor=!0),icon:"edit",label:"Edit"})]),_:1},8,["modelValue"])])]),_:1}),n(Y,{modelValue:e.showLayoutDialog,"onUpdate:modelValue":t[7]||(t[7]=o=>e.showLayoutDialog=o)},{default:l(()=>[n(x,{style:{width:"1150px","max-width":"90vw"}},{default:l(()=>[n(T,{style:{display:"flex","align-items":"center"}},{default:l(()=>[t[11]||(t[11]=y("div",{class:"text-h5"},"Select Layout",-1)),n(lt),M(n(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1}),n(T,{class:"q-pt-none"},{default:l(()=>[n(at,{modelValue:e.activeLayoutTab,"onUpdate:modelValue":t[5]||(t[5]=o=>e.activeLayoutTab=o)},{default:l(()=>[n(te,{name:"content",label:"Content"}),n(te,{name:"exercise",label:"Exercise"}),n(te,{name:"assessment",label:"Assessment"})]),_:1},8,["modelValue"]),n(st,{modelValue:e.activeLayoutTab,"onUpdate:modelValue":t[6]||(t[6]=o=>e.activeLayoutTab=o),animated:""},{default:l(()=>[(S(!0),V(Z,null,ee(e.layouts,(o,s)=>(S(),R(it,{key:s,name:s},{default:l(()=>[y("div",wt,[(S(!0),V(Z,null,ee(o,g=>(S(),V("div",{key:g.name,class:"col-12 col-sm-6 col-md-4"},[n(x,{class:"cursor-pointer layout-card",onClick:q=>e.selectLayout(g.name,s)},{default:l(()=>[n(rt,{src:g.image,height:"250px",style:{}},null,8,["src"]),n(T,{class:"layout-info"},{default:l(()=>[y("div",kt,j(g.label),1),y("div",It,j(g.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(ue,{align:"right"},{default:l(()=>[M(n(u,{flat:"",label:"Close",color:"primary"},null,512),[[O]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.loading?(S(),V("div",_t,[n(dt,{color:"blue",size:"70px",class:"loading-spinner"})])):Ze("",!0),n(Y,{modelValue:e.pushDialog,"onUpdate:modelValue":t[10]||(t[10]=o=>e.pushDialog=o)},{default:l(()=>[n(x,{style:{"min-width":"350px"}},{default:l(()=>[n(T,null,{default:l(()=>t[12]||(t[12]=[y("div",{class:"text-h6"},"X\xE1c nh\u1EADn c\u1EADp nh\u1EADt l\xEAn Firebase",-1)])),_:1}),n(T,{class:"q-pt-none"},{default:l(()=>[n(me,{modelValue:e.updateDescription,"onUpdate:modelValue":t[8]||(t[8]=o=>e.updateDescription=o),label:"M\xF4 t\u1EA3 c\u1EADp nh\u1EADt",type:"textarea",filled:"",autogrow:""},null,8,["modelValue"]),n(me,{modelValue:e.confirmLessonCode,"onUpdate:modelValue":t[9]||(t[9]=o=>e.confirmLessonCode=o),label:"Nh\u1EADp m\xE3 b\xE0i h\u1ECDc \u0111\u1EC3 x\xE1c nh\u1EADn",filled:"",class:"q-mt-md"},null,8,["modelValue"])]),_:1}),n(ue,{align:"right",class:"text-primary"},{default:l(()=>[M(n(u,{flat:"",label:"H\u1EE7y"},null,512),[[O]]),n(u,{flat:"",label:"X\xE1c nh\u1EADn",onClick:e.confirmPushToFirestore,loading:e.isUploading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],2)])}var Tt=Ie(ht,[["render",$t],["__scopeId","data-v-16043e3e"]]);const qt=we({name:"SlideShow",components:{SlideComponent:Tt},setup(){const e=i(tt),t=i(mt),m=p(()=>t.value.lessonSections.flatMap(r=>r.sectionActivities));return{lessonInfo:e,lessonActivities:m}}}),Vt={class:"slide-show"};function Ft(e,t,m,r,k,C){const b=ke("SlideComponent");return S(),R(De,{padding:""},{default:l(()=>[y("div",Vt,[n(b,{activities:e.lessonActivities},null,8,["activities"])])]),_:1})}var gn=Ie(qt,[["render",Ft],["__scopeId","data-v-cf46933a"]]);export{gn as default};
