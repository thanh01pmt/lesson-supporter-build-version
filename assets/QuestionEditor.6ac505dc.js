import{Q as J}from"./QSelect.70047d12.js";import{y as it,bU as st,bV as rt,i as ut,r as C,o as Xe,w as N,k as B,a4 as E,X as d,a9 as x,a7 as b,F as Z,aa as $,Y as V,q as o,bs as U,Z as r,a0 as he,a1 as L,br as ge,_ as xe,a6 as k,$ as A,bt as Re,ad as K,ae as O,ag as ce,L as W,ac as se,ab as Ye,c9 as ke,a5 as Ve,bx as Je,c8 as We,aG as Ze,bw as ct,bv as $e,aE as dt,ch as Te,aF as Qe,ci as mt,af as pt}from"./index.037f850d.js";import{Q as ht}from"./QBadge.c4b03a0c.js";import{Q as Se}from"./QSpace.8ac92afd.js";import{Q as ft}from"./QPage.a2da79f2.js";import{C as oe}from"./ClosePopup.f7b4fda5.js";import{u as gt,e as _e}from"./quizStore.de5eab0d.js";import{a as qe,Q as ze}from"./QTable.3729fe60.js";import{Q as vt}from"./QTr.671570e6.js";import{Q as ye,a as fe,b as et}from"./QItem.a6e550b6.js";import{Q as be}from"./QList.80fe3cd0.js";import{Q as yt}from"./ajv.fc11b563.js";import{u as Ce}from"./use-quasar.414eeb3f.js";import{A as bt}from"./AIQuizGen.9e797145.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Ct}from"./QBanner.958da182.js";import{C as wt}from"./CustomImage.fa404383.js";import{M as _t}from"./ContentRenderer.vue_vue_type_style_index_0_lang.ed268407.js";import{H as ve,S as Oe,M as Ue,a as Be,N as Ee}from"./NumericQuestion.d7b59b0a.js";import{Q as qt}from"./QSpinnerDots.6c974946.js";import{Q as Dt}from"./QImg.c60a9877.js";import{B as xt}from"./BlockRenderer.f5903b8a.js";import{Q as tt}from"./QForm.e3b755fa.js";import{_ as pe,a as kt}from"./ImportDataButton.a55bb82b.js";import{b as Ne}from"./schemaValidation.4d813734.js";import{Q as Vt}from"./QLinearProgress.f467e272.js";import{Q as De}from"./QExpansionItem.da0e08ff.js";import{Q as Tt}from"./rtl.ad3ba425.js";import{N as Qt}from"./NumberCard.81fed6eb.js";import"./selection.b5503321.js";import"./format.8ac60962.js";import"./QMarkupTable.c24125e0.js";import"./use-fullscreen.e9e81b6d.js";import"./QBtnGroup.06ca08ed.js";import"./googleAIService.c307673a.js";import"./QBtnToggle.c4c9bb64.js";import"./QFile.5371de78.js";const St='<rect y="10" width="15" height="120" rx="6"><animate attributeName="height" begin="0.5s" dur="1s" values="120;110;100;90;80;70;60;50;40;140;120" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="y" begin="0.5s" dur="1s" values="10;15;20;25;30;35;40;45;50;0;10" calcMode="linear" repeatCount="indefinite"></animate></rect><rect x="30" y="10" width="15" height="120" rx="6"><animate attributeName="height" begin="0.25s" dur="1s" values="120;110;100;90;80;70;60;50;40;140;120" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="y" begin="0.25s" dur="1s" values="10;15;20;25;30;35;40;45;50;0;10" calcMode="linear" repeatCount="indefinite"></animate></rect><rect x="60" width="15" height="140" rx="6"><animate attributeName="height" begin="0s" dur="1s" values="120;110;100;90;80;70;60;50;40;140;120" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="y" begin="0s" dur="1s" values="10;15;20;25;30;35;40;45;50;0;10" calcMode="linear" repeatCount="indefinite"></animate></rect><rect x="90" y="10" width="15" height="120" rx="6"><animate attributeName="height" begin="0.25s" dur="1s" values="120;110;100;90;80;70;60;50;40;140;120" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="y" begin="0.25s" dur="1s" values="10;15;20;25;30;35;40;45;50;0;10" calcMode="linear" repeatCount="indefinite"></animate></rect><rect x="120" y="10" width="15" height="120" rx="6"><animate attributeName="height" begin="0.5s" dur="1s" values="120;110;100;90;80;70;60;50;40;140;120" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="y" begin="0.5s" dur="1s" values="10;15;20;25;30;35;40;45;50;0;10" calcMode="linear" repeatCount="indefinite"></animate></rect>';var It=it({name:"QSpinnerBars",props:st,setup(l){const{cSize:t,classes:n}=rt(l);return()=>ut("svg",{class:n.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 135 140",xmlns:"http://www.w3.org/2000/svg",innerHTML:St})}});function Le(l){setTimeout(()=>{window.URL.revokeObjectURL(l.href)},1e4),l.remove()}function At(l,t,n={}){const{mimeType:e,byteOrderMark:f,encoding:m}=typeof n=="string"?{mimeType:n}:n,i=m!==void 0?new TextEncoder(m).encode([t]):t,a=f!==void 0?[f,i]:[i],s=new Blob(a,{type:e||"application/octet-stream"}),c=document.createElement("a");c.href=window.URL.createObjectURL(s),c.setAttribute("download",l),typeof c.download=="undefined"&&c.setAttribute("target","_blank"),c.classList.add("hidden"),c.style.position="fixed",document.body.appendChild(c);try{return c.click(),Le(c),!0}catch(y){return Le(c),y}}function Rt(l,t){if(!t)return l;const n=t.toLowerCase();return l.filter(e=>Object.values(e).some(f=>String(f).toLowerCase().includes(n)))}function zt(l,t){let n=l;for(const e in t)t[e].length>0&&(n=n.filter(f=>t[e].includes(f[e])));return n}function Ot(l,t){return l.filter(n=>t.some(e=>e.id===n.id))}function Pe(l,t,n){let e=t!==void 0?t(l,n):l;return e=e==null?"":String(e),e=e.split('"').join('""'),`"${e}"`}const Ut={components:{AIQuizGen:bt},props:{data:{type:Array,required:!0},columns:{type:Array,required:!0},columnFilters:{type:Object,default:()=>({})},visibleColumnsProp:{type:Array,default:()=>[]},enableExport:{type:Boolean,default:!1},statistics:{type:Object,default:null}},emits:["update:data","remove-row","row-click","show-row-detail","add-row","selected-rows-changed"],setup(l,{emit:t}){const n=Ce(),e=C([]),f=C(""),m=C(!1),i=C({}),a=C({}),s=C(l.visibleColumnsProp.length>0?l.visibleColumnsProp:l.columns.map(w=>w.name)),c=C(!1),y=C([]);C([]);const u=C([]),p=C(!1),h=C(!1),q=C({sortBy:"desc",descending:!1,page:1,rowsPerPage:10}),v=C(!1),_=C(null),g=[{label:"Tr\u1EAFc nghi\u1EC7m m\u1ED9t \u0111\xE1p \xE1n",value:"multiple_choice"},{label:"\u0110\xFAng/Sai",value:"true_false"},{label:"Tr\u1EAFc nghi\u1EC7m nhi\u1EC1u \u0111\xE1p \xE1n",value:"multiple_response"},{label:"Tr\u1EA3 l\u1EDDi ng\u1EAFn",value:"short_answer"},{label:"Gh\xE9p c\u1EB7p",value:"matching"},{label:"S\u1EAFp x\u1EBFp th\u1EE9 t\u1EF1",value:"sequence"},{label:"C\xE2u h\u1ECFi s\u1ED1",value:"numeric"}],I=w=>{console.log(w),t("update:data",w),h.value=!1,n.notify({type:"positive",message:"\u0110\xE3 th\xEAm c\xE2u h\u1ECFi th\xE0nh c\xF4ng!"})},R=w=>{console.log("Emitting show-row-detail with id:",w),t("show-row-detail",w)},z=()=>{t("add-row",_.value),v.value=!1,_.value=null};function Q(w){alert("Row clicked"),console.log("Row clicked:",JSON.stringify(w)),t("row-click",w)}const H=()=>{for(const w in l.columnFilters)l.columnFilters[w].type!=="date"&&(a.value[w]=[...new Set(l.data.map(T=>T[w]))])};Xe(()=>{for(const w in l.columnFilters)i.value[w]=[];H()}),N(()=>l.data,()=>{console.log(`New Data For Table: ${JSON.stringify(l.data)}`),m.value=!0,H(),m.value=!1}),N(()=>l.columnFilters,w=>{for(const T in w)i.value[T]||(i.value[T]=[]);H()},{deep:!0}),N(()=>l.visibleColumnsProp,w=>{s.value=w.length>0?w:l.columns.map(T=>T.name)});const M=B(()=>{let w=[...l.data];return p.value&&(w=Ot(w,e.value)),w=Rt(w,f.value),w=zt(w,i.value),w}),le=()=>{const w=e.value.length,T=M.value.length;return w===0?"":`${w} record${w>1?"s":""} selected of ${T}`},X=w=>{t("remove-row",w)},ne=()=>{const w=l.columns.filter(j=>s.value.includes(j.name)),T=[w.map(j=>Pe(j.label))].concat(e.value.map(j=>w.map(ee=>{var me;const ie=typeof ee.field=="function"?ee.field(j):j[(me=ee.field)!=null?me:ee.name];return Pe(ie,ee.format,j)}).join(","))).join(`\r
`);At("table-export.csv",T,"text/csv")!==!0&&n.notify({message:"Tr\xECnh duy\u1EC7t kh\xF4ng cho ph\xE9p t\u1EA3i xu\u1ED1ng t\u1EC7p...",color:"negative",icon:"warning"})};function Y(w){return w.map(T=>T._custom&&T._custom.type==="reactive"?T._custom.value:T)}N(e,()=>{let w=Y(e.value);t("selected-rows-changed",w),l.statistics&&e.value.length>0?y.value=ae(e.value,l.statistics):(l.statistics===null||e.value.length===0)&&(y.value=[])});const ae=(w,T)=>{const F=[];for(const j of T.rows){const ee={name:j.name};for(const ie of T.columns)ie.field&&j.calculate?ee[ie.field]=w.reduce((me,we)=>me+we[ie.field],0):ie.field&&!j.calculate&&(ee[ie.field]=w[0][ie.field]);F.push(ee)}return F};return{selected:e,searchKeyword:f,loading:m,filteredData:M,getSelectedString:le,removeRow:X,exportTable:ne,filterValues:i,filterOptions:a,getColumnLabel:w=>{const T=l.columns.find(F=>F.name===w);return T?T.label:w},visibleColumns:s,showStatisticsModal:c,statisticsData:y,calculateStatistics:ae,handleRowClick:Q,showRowDetail:R,pagination:q,showAddQuestionDialog:v,selectedQuestionType:_,questionTypeOptions:g,handleAddQuestion:z,selectedRows:u,showSelectedOnly:p,normalizeReactiveObjects:Y,showAIQuizGenDialog:h,handleAIQuizCreated:I}}},Bt={class:"q-ma-none q-pa-none custom-table"},Et={class:"q-gutter-sm row items-start"},Nt={class:"row items-center justify-between full-width"},Lt={key:2,class:"row q-gutter-sm q-mr-md items-center"};function Pt(l,t,n,e,f,m){const i=E("AIQuizGen");return d(),x("div",Bt,[b("div",Et,[(d(!0),x(Z,null,$(n.columnFilters,(a,s)=>(d(),V(J,{key:s,filled:"",modelValue:e.filterValues[s],"onUpdate:modelValue":c=>e.filterValues[s]=c,options:e.filterOptions[s],label:e.getColumnLabel(s),multiple:"",clearable:"",style:{width:"250px"},class:"q-mb-md"},null,8,["modelValue","onUpdate:modelValue","options","label"]))),128)),o(U,{filled:"",modelValue:e.searchKeyword,"onUpdate:modelValue":t[0]||(t[0]=a=>e.searchKeyword=a),placeholder:"T\xECm ki\u1EBFm...",debounce:"300",clearable:"",class:"q-mb-md",style:{width:"250px"}},null,8,["modelValue"])]),e.filteredData.length?(d(),V(ze,{key:0,title:"Questions",flat:"",bordered:"","sticky-header":"",rows:e.filteredData,"row-key":"id",columns:n.columns,"selected-rows-label":e.getSelectedString,selection:"multiple",selected:e.selected,"onUpdate:selected":t[8]||(t[8]=a=>e.selected=a),pagination:e.pagination,"onUpdate:pagination":t[9]||(t[9]=a=>e.pagination=a),loading:e.loading,"visible-columns":e.visibleColumns},{loading:r(()=>[o(It,{size:"40px",color:"primary"})]),"no-data":r(()=>t[13]||(t[13]=[b("div",{class:"q-pa-md text-grey-8"},"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u.",-1)])),"body-row":r(a=>[o(vt,{onClick:ge(s=>e.handleRowClick(a.row),["prevent"]),props:a,class:"cursor-pointer"},{default:r(()=>[(d(!0),x(Z,null,$(a.cols,s=>(d(),V(qe,{key:s.name,props:a},{default:r(()=>[he(L(a.row[s.field]),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["onClick","props"])]),"body-cell-remove":r(a=>[o(qe,{props:a},{default:r(()=>[o(xe,{name:"delete",onClick:ge(s=>e.removeRow(a.row),["stop"]),class:"cursor-pointer"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-detail":r(a=>[o(qe,{props:a},{default:r(()=>[o(xe,{name:"info",onClick:ge(s=>e.showRowDetail(a.row.id),["stop"]),class:"cursor-pointer"},null,8,["onClick"])]),_:2},1032,["props"])]),pagination:r(a=>[b("div",Nt,[o(yt,{color:"primary",icon:"add",label:"Th\xEAm c\xE2u h\u1ECFi",unelevated:""},{default:r(()=>[o(be,null,{default:r(()=>[o(ye,{clickable:"",onClick:t[1]||(t[1]=s=>e.showAddQuestionDialog=!0)},{default:r(()=>[o(fe,null,{default:r(()=>t[14]||(t[14]=[he("Nh\u1EADp th\u1EE7 c\xF4ng")])),_:1})]),_:1}),o(ye,{clickable:"",onClick:t[2]||(t[2]=s=>e.showAIQuizGenDialog=!0)},{default:r(()=>[o(fe,null,{default:r(()=>t[15]||(t[15]=[he("T\u1EA1o v\u1EDBi AI")])),_:1})]),_:1})]),_:1})]),_:1}),b("div",null,[a.pagesNumber>2?(d(),V(k,{key:0,icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:a.isFirstPage,onClick:a.firstPage},null,8,["disable","onClick"])):A("",!0),o(k,{icon:"chevron_left",color:"grey-8",round:"",dense:"",flat:"",disable:a.isFirstPage,onClick:a.prevPage},null,8,["disable","onClick"]),o(k,{icon:"chevron_right",color:"grey-8",round:"",dense:"",flat:"",disable:a.isLastPage,onClick:a.nextPage},null,8,["disable","onClick"]),a.pagesNumber>2?(d(),V(k,{key:1,icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:a.isLastPage,onClick:a.lastPage},null,8,["disable","onClick"])):A("",!0)])])]),"top-right":r(()=>[n.statistics&&e.selected.length>0?(d(),V(k,{key:0,color:"primary",icon:"search",dense:"",round:"",onClick:t[3]||(t[3]=a=>e.showStatisticsModal=!0),class:"q-ml-md"})):A("",!0),l.$q.screen.lt.md?(d(),V(J,{key:1,modelValue:e.visibleColumns,"onUpdate:modelValue":t[4]||(t[4]=a=>e.visibleColumns=a),multiple:"",borderless:"",dense:"","options-dense":"","display-value":l.q.lang.table.columns,"emit-value":"","map-options":"",options:n.columns,"option-value":"name",style:{"min-width":"150px"},class:"q-ml-md"},null,8,["modelValue","display-value","options"])):(d(),x("div",Lt,[(d(!0),x(Z,null,$(n.columns,a=>(d(),V(Re,{key:a.name,modelValue:e.visibleColumns,"onUpdate:modelValue":t[5]||(t[5]=s=>e.visibleColumns=s),val:a.name,label:a.label},null,8,["modelValue","val","label"]))),128)),o(Re,{modelValue:e.showSelectedOnly,"onUpdate:modelValue":t[6]||(t[6]=a=>e.showSelectedOnly=a),label:"Ch\u1EC9 hi\u1EC3n th\u1ECB \u0111\xE3 ch\u1ECDn",disable:!e.selected.length},null,8,["modelValue","disable"])])),n.enableExport?(d(),V(k,{key:3,color:"primary","icon-right":"archive",label:"Xu\u1EA5t CSV","no-caps":"",onClick:e.exportTable},null,8,["onClick"])):A("",!0),o(se,{modelValue:e.showStatisticsModal,"onUpdate:modelValue":t[7]||(t[7]=a=>e.showStatisticsModal=a)},{default:r(()=>[o(K,null,{default:r(()=>[o(O,null,{default:r(()=>t[16]||(t[16]=[b("div",{class:"text-h6"},"Th\u1ED1ng k\xEA",-1)])),_:1}),o(O,null,{default:r(()=>[o(ze,{rows:e.statisticsData,columns:n.statistics.columns,"row-key":"name","hide-bottom":""},null,8,["rows","columns"])]),_:1}),o(ce,{align:"right"},{default:r(()=>[W(o(k,{flat:"",label:"\u0110\xF3ng",color:"primary"},null,512),[[oe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","selected-rows-label","selected","pagination","loading","visible-columns"])):A("",!0),o(se,{modelValue:e.showAddQuestionDialog,"onUpdate:modelValue":t[11]||(t[11]=a=>e.showAddQuestionDialog=a)},{default:r(()=>[o(K,{style:{"min-width":"350px"}},{default:r(()=>[o(O,null,{default:r(()=>t[17]||(t[17]=[b("div",{class:"text-h6"},"Ch\u1ECDn lo\u1EA1i c\xE2u h\u1ECFi",-1)])),_:1}),o(O,null,{default:r(()=>[o(J,{modelValue:e.selectedQuestionType,"onUpdate:modelValue":t[10]||(t[10]=a=>e.selectedQuestionType=a),options:e.questionTypeOptions,label:"Lo\u1EA1i c\xE2u h\u1ECFi",filled:"","emit-value":"","map-options":"",rules:[a=>!!a||"Vui l\xF2ng ch\u1ECDn lo\u1EA1i c\xE2u h\u1ECFi"]},null,8,["modelValue","options","rules"])]),_:1}),o(ce,{align:"right",class:"text-primary"},{default:r(()=>[W(o(k,{flat:"",label:"H\u1EE7y"},null,512),[[oe]]),o(k,{flat:"",label:"T\u1EA1o c\xE2u h\u1ECFi",onClick:e.handleAddQuestion,disable:!e.selectedQuestionType},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(se,{modelValue:e.showAIQuizGenDialog,"onUpdate:modelValue":t[12]||(t[12]=a=>e.showAIQuizGenDialog=a),fullscreen:""},{default:r(()=>[o(K,null,{default:r(()=>[o(O,{class:"row items-center q-pb-none"},{default:r(()=>[t[18]||(t[18]=b("div",{class:"text-h6"},"T\u1EA1o c\xE2u h\u1ECFi v\u1EDBi AI",-1)),o(Se),W(o(k,{icon:"close",flat:"",round:"",dense:""},null,512),[[oe]])]),_:1}),o(O,{class:"q-pt-none"},{default:r(()=>[o(i,{onCreated:e.handleAIQuizCreated},null,8,["onCreated"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Mt=G(Ut,[["render",Pt],["__scopeId","data-v-3b17bbd0"]]);const Ht={class:"code-block q-my-md"},Ft={class:"code-header q-px-sm q-py-xs bg-grey-3"},jt=["innerHTML"],Kt={__name:"CodeBlock",props:{code:{type:String,required:!0},language:{type:String,default:"plaintext"}},setup(l){const t=l,n=B(()=>{try{return t.language&&ve.getLanguage(t.language)?ve.highlight(t.code,{language:t.language}).value:ve.highlightAuto(t.code).value}catch(e){return console.warn("Highlight error:",e),t.code}});return(e,f)=>(d(),x("div",Ht,[b("div",Ft,[b("span",null,L(l.language),1)]),b("pre",{class:"q-pa-md",innerHTML:n.value},null,8,jt)]))}};var Me=G(Kt,[["__scopeId","data-v-5b42a98f"]]);const Gt={class:"inline-code q-px-sm"},Xt={__name:"InlineCode",props:{code:{type:String,required:!0}},setup(l){return(t,n)=>(d(),x("code",Gt,L(l.code),1))}};var He=G(Xt,[["__scopeId","data-v-745f81c4"]]);const Yt={class:"media-renderer q-my-none"},Jt=["src"],Wt=["src"],Zt={key:2,class:"media-preview-wrapper"},$t={class:"zoom-btn absolute-bottom-right q-pa-sm"},el={class:"modal-container"},tl=["src"],ll={__name:"MediaRenderer",props:{url:{type:String,required:!0},type:{type:String,required:!0,validator:l=>["youtube","vimeo","image"].includes(l)}},setup(l){const t=l,n=B(()=>{if(t.type==="youtube"){const i=t.url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);return i?i[1]:null}else if(t.type==="vimeo"){const i=t.url.match(/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/);return i?i[1]:null}return null}),e=C(!1),f=()=>{e.value=!0},m=()=>{e.value=!1};return(i,a)=>(d(),x("div",Yt,[l.type==="youtube"?(d(),x("iframe",{key:0,src:"https://www.youtube.com/embed/"+n.value,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:"",class:"video-frame"},null,8,Jt)):l.type==="vimeo"?(d(),x("iframe",{key:1,src:"https://player.vimeo.com/video/"+n.value,frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowfullscreen:"",class:"video-frame"},null,8,Wt)):l.type==="image"?(d(),x("div",Zt,[o(Dt,{src:l.url,fit:"contain",class:"rounded-borders custom-image",onClick:f},{loading:r(()=>[o(qt,{color:"primary"})]),error:r(()=>a[1]||(a[1]=[b("div",{class:"absolute-full flex flex-center text-caption text-grey"}," Unable to load image ",-1)])),default:r(()=>[b("div",$t,[o(k,{round:"",color:"white","text-color":"black",icon:"zoom_in",size:"sm",onClick:ge(f,["stop"])})])]),_:1},8,["src"]),o(se,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value=s),onHide:m},{default:r(()=>[b("div",el,[o(k,{icon:"close",flat:"",round:"",dense:"",class:"close-btn",onClick:m}),b("img",{src:l.url,class:"modal-image"},null,8,tl)])]),_:1},8,["modelValue"])])):A("",!0)]))}};var Fe=G(ll,[["__scopeId","data-v-7284a8cd"]]);const al={class:"scratch-block q-my-md"},ol={__name:"ScratchBlock",props:{code:{type:String,required:!0}},setup(l){return(t,n)=>(d(),x("div",al,[n[0]||(n[0]=b("div",{class:"code-header q-px-sm q-py-xs bg-grey-3"},[b("span",null,"scratch")],-1)),o(xt,{script:l.code,blockStyle:"scratch3",fromLang:"en",toLang:"vi",class:"q-mt-sm q-mx-sm"},null,8,["script"])]))}};var je=G(ol,[["__scopeId","data-v-86de68fe"]]);const nl={components:{CodeBlock:Me,InlineCode:He,MediaRenderer:Fe,ScratchBlock:je},props:{content:{type:String,default:""}},setup(l){const t=new _t({html:!0,highlight:function(f,m){if(m&&ve.getLanguage(m))try{return ve.highlight(f,{language:m}).value}catch{}return""}}),n=f=>f?/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/.test(f)?"youtube":/(?:www\.|player\.)?vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/.test(f)?"vimeo":/\.(jpg|jpeg|png|gif|webp)$/i.test(f)?"image":null:null;return{parsedContent:B(()=>{var v;if(!l.content)return[];const f=[];let m=l.content;const i=/```(\w+)?\n([\s\S]*?)```/g;let a,s=[];for(;(a=i.exec(m))!==null;){const _=((v=a[1])==null?void 0:v.toLowerCase())||"plaintext",g={start:a.index,end:a.index+a[0].length};s.push(g);const I=_==="scratch"?je:Me;f.push({type:"code-block",start:a.index,end:a.index+a[0].length,component:I,props:{code:a[2].trim(),language:_},originalText:a[0]})}const c=_=>s.some(g=>_>=g.start&&_<g.end),y=/`([\w-]+)`/g;for(;(a=y.exec(m))!==null;)c(a.index)||f.push({type:"inline-code",start:a.index,end:a.index+a[0].length,component:He,props:{code:a[1]},originalText:a[0]});const u=/(https?:\/\/[^\s]+)/g;for(;(a=u.exec(m))!==null;)if(!c(a.index)){const _=n(a[0]);_&&f.push({type:"media",start:a.index,end:a.index+a[0].length,component:Fe,props:{url:a[0],type:_},originalText:a[0]})}f.sort((_,g)=>_.start-g.start);const p=[];let h=0,q="";return f.forEach(_=>{_.start>h&&(q+=m.slice(h,_.start)),_.type==="inline-code"?q+=_.originalText:(q.trim()&&p.push({component:"div",props:{innerHTML:t.render(q)}}),q="",p.push({component:_.component,props:_.props})),h=_.end}),h<m.length&&(q+=m.slice(h),q.trim()&&p.push({component:"div",props:{innerHTML:t.render(q)}})),p})}}},il={class:"content-renderer q-pa-md"};function sl(l,t,n,e,f,m){return d(),x("div",il,[(d(!0),x(Z,null,$(e.parsedContent,(i,a)=>(d(),V(ke(i.component),Ye({key:a,ref_for:!0},i.props),null,16))),128))])}var Ie=G(nl,[["render",sl]]);const rl={name:"MultipleChoiceQuestion",components:{ContentRenderer:Ie},props:{questionData:{type:Object,required:!0},questionNumber:{type:Number,required:!0},showCorrectAnswer:{type:Boolean,default:!1}},setup(l,{emit:t}){const n=C([]),e=C(null),f=C(!1),m=B(()=>l.questionData.type==="multiple_response"),i=B(()=>!f.value&&!l.showCorrectAnswer),a=y=>m.value?n.value.includes(y):e.value===y,s=()=>{var h,q,v,_,g;const y=l.questionData.options.map((I,R)=>I.isCorrect?R:-1).filter(I=>I!==-1);let u=!1,p;m.value?(p=n.value,u=y.length===p.length&&y.every(I=>p.includes(I))):(p=((h=l.questionData.options[e.value])==null?void 0:h.text)||null,u=((q=l.questionData.options[e.value])==null?void 0:q.isCorrect)||!1),t("answer-selected",{questionNum:l.questionNumber,answer:p,isCorrect:u,type:l.questionData.type,question:l.questionData.question,correctAnswer:c(),bloomTaxonomy:((v=l.questionData.metadata)==null?void 0:v.bloomTaxonomy)||null,concepts:((_=l.questionData.metadata)==null?void 0:_.concepts)||null,conceptDescription:((g=l.questionData.metadata)==null?void 0:g.conceptDescription)||null,explanation:l.questionData.explanation||null})},c=()=>{if(m.value)return l.questionData.options.filter(y=>y.isCorrect).map(y=>y.text);{const y=l.questionData.options.find(u=>u.isCorrect);return y?y.text:null}};return N(()=>l.showCorrectAnswer,y=>{y?(m.value?n.value=l.questionData.options.map((u,p)=>u.isCorrect?p:null).filter(u=>u!==null):e.value=l.questionData.options.findIndex(u=>u.isCorrect),s()):f.value||(n.value=[],e.value=null)}),N([e,n],()=>{!f.value&&!l.showCorrectAnswer&&s()}),{selectedAnswers:n,selectedAnswer:e,isChecked:f,isMultipleResponse:m,isSelected:a,canCheck:i,emitAnswer:s,getCorrectAnswer:c}}};function ul(l,t,n,e,f,m){const i=E("ContentRenderer");return d(),V(be,{class:"answer-list",bordered:"",separator:""},{default:r(()=>[(d(!0),x(Z,null,$(n.questionData.options,(a,s)=>W((d(),V(ye,{style:{height:"auto"},key:s,tag:"label",class:Ve(["answer-item q-py-xs cursor-pointer",{selected:e.isSelected(s)}])},{default:r(()=>[o(fe,{side:""},{default:r(()=>[e.isMultipleResponse?(d(),V(Je,{key:0,modelValue:e.selectedAnswers,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedAnswers=c),val:s,disable:!e.canCheck},null,8,["modelValue","val","disable"])):(d(),V(We,{key:1,modelValue:e.selectedAnswer,"onUpdate:modelValue":t[1]||(t[1]=c=>e.selectedAnswer=c),val:s,disable:!e.canCheck},null,8,["modelValue","val","disable"]))]),_:2},1024),o(fe,null,{default:r(()=>[o(et,null,{default:r(()=>[o(i,{content:a.text,class:"full-width"},null,8,["content"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])),[[Ze]])),128))]),_:1})}var Ke=G(rl,[["render",ul],["__scopeId","data-v-6cfc247c"]]);const cl={name:"TrueFalseQuestion",components:{ContentRenderer:Ie},props:{questionData:{type:Object,required:!0},questionNumber:{type:Number,required:!0},showCorrectAnswer:{type:Boolean,default:!1}},setup(l,{emit:t}){const n=C(null),e=C(!1),f=B(()=>!e.value&&!l.showCorrectAnswer),m=u=>n.value===u,i=u=>{try{const h=new URL(u).pathname.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","webp"].includes(h)}catch{return!1}},a=u=>typeof u=="string"?["#","*","_","`","[","]"].some(h=>u.includes(h)):!1,s=(u,p)=>{if(p&&hljs.getLanguage(p))try{return hljs.highlight(u,{language:p}).value}catch{}return""},c=()=>{var h,q,v,_,g;if(n.value===null)return;const u=((h=l.questionData.options[n.value])==null?void 0:h.isCorrect)||!1,p=((q=l.questionData.options[n.value])==null?void 0:q.text)||null;t("answer-selected",{questionNum:l.questionNumber,answer:p,isCorrect:u,type:l.questionData.type,question:l.questionData.question,correctAnswer:y(),bloomTaxonomy:((v=l.questionData.metadata)==null?void 0:v.bloomTaxonomy)||null,concepts:((_=l.questionData.metadata)==null?void 0:_.concepts)||null,conceptDescription:((g=l.questionData.metadata)==null?void 0:g.conceptDescription)||null,explanation:l.questionData.explanation||null})},y=()=>{const u=l.questionData.options.find(p=>p.isCorrect);return u?u.text:null};return N(()=>l.showCorrectAnswer,u=>{u?(n.value=l.questionData.options.findIndex(p=>p.isCorrect),c()):e.value||(n.value=null)}),N(n,()=>{!e.value&&!l.showCorrectAnswer&&c()}),{selectedAnswer:n,isChecked:e,canCheck:f,isSelected:m,isImageLink:i,isMarkdown:a,highlighter:s,emitAnswer:c,getCorrectAnswer:y}}};function dl(l,t,n,e,f,m){const i=E("ContentRenderer");return d(),x("div",null,[o(be,{bordered:"",separator:"",class:"answer-list"},{default:r(()=>[(d(!0),x(Z,null,$(n.questionData.options,(a,s)=>W((d(),V(ye,{key:s,tag:"label",class:Ve(["answer-item q-py-md cursor-pointer",{selected:e.isSelected(s)}])},{default:r(()=>[o(fe,{side:""},{default:r(()=>[o(We,{modelValue:e.selectedAnswer,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedAnswer=c),val:s,disable:!e.canCheck},null,8,["modelValue","val","disable"])]),_:2},1024),o(fe,null,{default:r(()=>[o(et,null,{default:r(()=>[o(i,{content:a.text,class:"full-width"},null,8,["content"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])),[[Ze]])),128))]),_:1})])}var Ge=G(cl,[["render",dl],["__scopeId","data-v-15c68248"]]);const ml={name:"GeneralQuestion",components:{ContentRenderer:Ie,CustomImage:wt,MultipleChoiceQuestion:Ke,TrueFalseQuestion:Ge,ShortAnswerQuestion:Oe,MatchingQuestion:Ue,SequenceQuestion:Be,NumericQuestion:Ee},props:{questionData:{type:Object,required:!0},questionNumber:{type:Number,required:!0},showCorrectAnswer:{type:Boolean,default:!1},showFeedback:{type:Boolean,default:!1}},setup(l,{emit:t}){const n=gt(),e=C(null),f=C(!1),m=C(""),i=B(()=>({"bg-positive-1 text-positive":f.value,"bg-warning-1 text-warning":!f.value}));return{quizStore:n,getQuestionComponent:()=>{switch(l.questionData.type){case"multiple_choice":case"multiple_response":return Ke;case"true_false":return Ge;case"short_answer":return Oe;case"matching":return Ue;case"sequence":return Be;case"numeric":return Ee;default:return null}},handleAnswerSelected:y=>{e.value=y,f.value=y.isCorrect,m.value=y.isCorrect?"\u0110\xFAng":"Sai",t("answer-selected",y)},checkAnswer:()=>{e.value&&t("answer-submitted",e.value)},isCorrect:f,feedback:m,feedbackClass:i}}},pl=["id"],hl={class:"question-header q-mb-lg"},fl={class:"question-number"},gl={class:"question-text text-body1 q-my-none"},vl={key:0,class:"question-image q-my-md"};function yl(l,t,n,e,f,m){const i=E("ContentRenderer"),a=E("CustomImage");return d(),x("div",{id:`question-${n.questionNumber}`,class:"question-card q-pa-md"},[b("div",hl,[b("div",fl,"C\xE2u "+L(n.questionNumber),1),b("div",gl,[o(i,{content:n.questionData.question},null,8,["content"])])]),n.questionData.image?(d(),x("div",vl,[o(a,{src:n.questionData.image,maxHeight:"280px"},null,8,["src"])])):A("",!0),(d(),V(ke(e.getQuestionComponent()),{"question-data":n.questionData,"question-number":n.questionNumber,"show-correct-answer":n.showCorrectAnswer,onAnswerSelected:e.handleAnswerSelected},null,40,["question-data","question-number","show-correct-answer","onAnswerSelected"])),e.feedback&&n.showFeedback?(d(),V(Ct,{key:1,class:Ve(["q-mt-md",e.feedbackClass]),rounded:""},{avatar:r(()=>[o(xe,{name:e.isCorrect?"check_circle":"error",color:e.isCorrect?"positive":"warning",size:"md"},null,8,["name","color"])]),default:r(()=>[he(" "+L(e.feedback),1)]),_:1},8,["class"])):A("",!0)],8,pl)}var bl=G(ml,[["render",yl],["__scopeId","data-v-609bc662"]]);const Cl={name:"EditQuestionForm",props:{modelValue:{type:Object,required:!0},questionType:{type:String,required:!0}},emits:["update:modelValue"],setup(l,{emit:t}){const n=C({}),e=[{label:"Ghi nh\u1EDB",value:"remembering"},{label:"Hi\u1EC3u",value:"understanding"},{label:"\xC1p d\u1EE5ng",value:"applying"},{label:"Ph\xE2n t\xEDch",value:"analyzing"},{label:"\u0110\xE1nh gi\xE1",value:"evaluating"},{label:"S\xE1ng t\u1EA1o",value:"creating"}],f=c=>{const y={id:l.modelValue.id||`new_${Date.now()}`,type:c,question:"",options:[],metadata:{bloomTaxonomy:"",concepts:[],conceptDescription:"",difficulty:"medium"},explanation:""};switch(c){case"multiple_choice":case"multiple_response":y.options=[{text:"",isCorrect:!1},{text:"",isCorrect:!1}];break;case"true_false":y.options=[{text:"\u0110\xFAng",isCorrect:!1},{text:"Sai",isCorrect:!1}];break;case"short_answer":y.correctCriteria={type:"exact",value:""};break;case"matching":y.options=[{text:"",match:""},{text:"",match:""}];break;case"sequence":y.options=[{text:"",order:1},{text:"",order:2}];break;case"numeric":y.correctCriteria={type:"range",value:[0,0],tolerance:0};break}return y};N(()=>l.modelValue,c=>{var y,u,p;if(pe.isEmpty(c))n.value=f(l.questionType);else{const{lastChange:h,...q}=c;n.value=pe.cloneDeep({...q,metadata:{...q.metadata,bloomTaxonomy:((y=q.metadata)==null?void 0:y.bloomTaxonomy)==="understand"?"understanding":(u=q.metadata)==null?void 0:u.bloomTaxonomy,concepts:Array.isArray((p=q.metadata)==null?void 0:p.concepts)?q.metadata.concepts:[]}})}},{immediate:!0,deep:!0}),N(n,c=>{var y;if(!pe.isEqual(c,l.modelValue)){const u=pe.cloneDeep(c);if(!u.options||u.options.length===0)switch(l.questionType){case"multiple_choice":case"multiple_response":u.options=[{text:"",isCorrect:!1}];break;case"true_false":u.options=[{text:"\u0110\xFAng",isCorrect:!1},{text:"Sai",isCorrect:!1}];break;case"matching":u.options=[{text:"",match:""}];break;case"sequence":u.options=[{text:"",order:1}];break}["short_answer","numeric"].includes(l.questionType)&&(u.correctCriteria||(u.correctCriteria={type:l.questionType==="short_answer"?"exact":"range",value:l.questionType==="short_answer"?"":[0,0]})),(y=u.metadata)!=null&&y.concepts&&(u.metadata.concepts=u.metadata.concepts.map(p=>typeof p=="string"?p:p.toString())),t("update:modelValue",u)}},{deep:!0});const m=()=>{n.value.options||(n.value.options=[]);const c={text:""};switch(l.questionType){case"multiple_choice":case"multiple_response":case"true_false":c.isCorrect=!1;break;case"matching":c.match="";break;case"sequence":c.order=n.value.options.length+1;break}n.value.options.push(c)};return{formData:n,bloomTaxonomyOptions:e,addOption:m,removeOption:c=>{n.value.options.splice(c,1),l.questionType==="sequence"&&n.value.options.forEach((y,u)=>{y.order=u+1}),n.value.options.length===0&&m()},isValidUrl:c=>{if(!c)return!0;try{return new URL(c),!0}catch{return!1}},submitForm:()=>{console.log("Form submitted!")}}}},wl={class:"q-gutter-md"},_l={key:0},ql={key:1},Dl={key:2},xl={key:3},kl={key:4};function Vl(l,t,n,e,f,m){return d(),V(tt,{onSubmit:e.submitForm},{default:r(()=>[b("div",wl,[o(U,{autogrow:"",modelValue:e.formData.question,"onUpdate:modelValue":t[0]||(t[0]=i=>e.formData.question=i),filled:"",label:"N\u1ED9i dung c\xE2u h\u1ECFi",rules:[i=>!!i||"Vui l\xF2ng nh\u1EADp n\u1ED9i dung c\xE2u h\u1ECFi"]},null,8,["modelValue","rules"]),o(U,{autogrow:"",modelValue:e.formData.image,"onUpdate:modelValue":t[1]||(t[1]=i=>e.formData.image=i),filled:"",label:"Link h\xECnh \u1EA3nh c\xE2u h\u1ECFi (n\u1EBFu c\xF3)",rules:[i=>!i||e.isValidUrl(i)||"Link h\xECnh \u1EA3nh kh\xF4ng h\u1EE3p l\u1EC7"]},null,8,["modelValue","rules"]),n.questionType==="multiple_choice"||n.questionType==="multiple_response"||n.questionType==="true_false"?(d(),x("div",_l,[(d(!0),x(Z,null,$(e.formData.options,(i,a)=>(d(),x("div",{key:a,class:"row q-gutter-sm items-center"},[o(U,{autogrow:"",modelValue:i.text,"onUpdate:modelValue":s=>i.text=s,filled:"",label:"\u0110\xE1p \xE1n",rules:[s=>!!s||"Vui l\xF2ng nh\u1EADp \u0111\xE1p \xE1n"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"]),o(Je,{modelValue:i.isCorrect,"onUpdate:modelValue":s=>i.isCorrect=s,label:"\u0110\xFAng",class:"col-auto"},null,8,["modelValue","onUpdate:modelValue"]),o(k,{flat:"",round:"",dense:"",icon:"delete",onClick:s=>e.removeOption(a),disable:e.formData.options.length<=(n.questionType==="true_false"?2:1),class:"col-auto"},null,8,["onClick","disable"]),o(U,{autogrow:"",modelValue:i.image,"onUpdate:modelValue":s=>i.image=s,filled:"",label:"Link h\xECnh \u1EA3nh \u0111\xE1p \xE1n (n\u1EBFu c\xF3)",rules:[s=>!s||e.isValidUrl(s)||"Link h\xECnh \u1EA3nh kh\xF4ng h\u1EE3p l\u1EC7"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"])]))),128)),o(k,{color:"primary",label:"Th\xEAm \u0111\xE1p \xE1n",onClick:e.addOption,class:"q-mt-sm"},null,8,["onClick"])])):A("",!0),n.questionType==="short_answer"?(d(),x("div",ql,[o(U,{autogrow:"",modelValue:e.formData.correctCriteria.value,"onUpdate:modelValue":t[2]||(t[2]=i=>e.formData.correctCriteria.value=i),filled:"",label:"\u0110\xE1p \xE1n \u0111\xFAng",rules:[i=>!!i||"Vui l\xF2ng nh\u1EADp \u0111\xE1p \xE1n \u0111\xFAng"]},null,8,["modelValue","rules"])])):A("",!0),n.questionType==="matching"?(d(),x("div",Dl,[(d(!0),x(Z,null,$(e.formData.options,(i,a)=>(d(),x("div",{key:a,class:"row q-gutter-sm items-center"},[o(U,{autogrow:"",modelValue:i.text,"onUpdate:modelValue":s=>i.text=s,filled:"",label:"M\u1EE5c c\u1EA7n gh\xE9p",rules:[s=>!!s||"Vui l\xF2ng nh\u1EADp m\u1EE5c c\u1EA7n gh\xE9p"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"]),o(U,{autogrow:"",modelValue:i.match,"onUpdate:modelValue":s=>i.match=s,filled:"",label:"Gi\xE1 tr\u1ECB t\u01B0\u01A1ng \u1EE9ng",rules:[s=>!!s||"Vui l\xF2ng nh\u1EADp gi\xE1 tr\u1ECB t\u01B0\u01A1ng \u1EE9ng"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"]),o(k,{flat:"",round:"",dense:"",icon:"delete",onClick:s=>e.removeOption(a),disable:e.formData.options.length<=1,class:"col-auto"},null,8,["onClick","disable"])]))),128)),o(k,{color:"primary",label:"Th\xEAm c\u1EB7p gh\xE9p n\u1ED1i",onClick:e.addOption,class:"q-mt-sm"},null,8,["onClick"])])):A("",!0),n.questionType==="sequence"?(d(),x("div",xl,[(d(!0),x(Z,null,$(e.formData.options,(i,a)=>(d(),x("div",{key:a,class:"row q-gutter-sm items-center"},[o(U,{autogrow:"",modelValue:i.text,"onUpdate:modelValue":s=>i.text=s,filled:"",label:"M\u1EE5c",rules:[s=>!!s||"Vui l\xF2ng nh\u1EADp m\u1EE5c"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"]),o(U,{autogrow:"",modelValue:i.order,"onUpdate:modelValue":s=>i.order=s,modelModifiers:{number:!0},filled:"",label:"Th\u1EE9 t\u1EF1",type:"number",rules:[s=>!!s||"Vui l\xF2ng nh\u1EADp th\u1EE9 t\u1EF1"],class:"col"},null,8,["modelValue","onUpdate:modelValue","rules"]),o(k,{flat:"",round:"",dense:"",icon:"delete",onClick:s=>e.removeOption(a),disable:e.formData.options.length<=1,class:"col-auto"},null,8,["onClick","disable"])]))),128)),o(k,{color:"primary",label:"Th\xEAm m\u1EE5c",onClick:e.addOption,class:"q-mt-sm"},null,8,["onClick"])])):A("",!0),n.questionType==="numeric"?(d(),x("div",kl,[o(U,{autogrow:"",modelValue:e.formData.correctCriteria.value[0],"onUpdate:modelValue":t[3]||(t[3]=i=>e.formData.correctCriteria.value[0]=i),modelModifiers:{number:!0},filled:"",label:"Gi\xE1 tr\u1ECB nh\u1ECF nh\u1EA5t",type:"number",rules:[i=>i!=null||"Vui l\xF2ng nh\u1EADp gi\xE1 tr\u1ECB"]},null,8,["modelValue","rules"]),o(U,{autogrow:"",modelValue:e.formData.correctCriteria.value[1],"onUpdate:modelValue":t[4]||(t[4]=i=>e.formData.correctCriteria.value[1]=i),modelModifiers:{number:!0},filled:"",label:"Gi\xE1 tr\u1ECB l\u1EDBn nh\u1EA5t",type:"number",rules:[i=>i!=null||"Vui l\xF2ng nh\u1EADp gi\xE1 tr\u1ECB"]},null,8,["modelValue","rules"]),o(U,{autogrow:"",modelValue:e.formData.correctCriteria.tolerance,"onUpdate:modelValue":t[5]||(t[5]=i=>e.formData.correctCriteria.tolerance=i),modelModifiers:{number:!0},filled:"",label:"Sai s\u1ED1 cho ph\xE9p",type:"number",rules:[i=>i>=0||"Sai s\u1ED1 ph\u1EA3i l\u1EDBn h\u01A1n ho\u1EB7c b\u1EB1ng 0"]},null,8,["modelValue","rules"])])):A("",!0),o(J,{modelValue:e.formData.metadata.bloomTaxonomy,"onUpdate:modelValue":t[6]||(t[6]=i=>e.formData.metadata.bloomTaxonomy=i),filled:"",label:"Bloom Taxonomy",options:e.bloomTaxonomyOptions,dense:"","options-dense":"","emit-value":"","map-options":"",rules:[i=>!!i||"Vui l\xF2ng ch\u1ECDn Bloom Taxonomy"]},null,8,["modelValue","options","rules"]),o(J,{modelValue:e.formData.metadata.concepts,"onUpdate:modelValue":t[7]||(t[7]=i=>e.formData.metadata.concepts=i),filled:"",label:"Concepts",multiple:"","use-input":"","use-chips":"","input-debounce":"0","new-value-mode":"add-unique",rules:[i=>i&&i.length>0||"Vui l\xF2ng nh\u1EADp \xEDt nh\u1EA5t m\u1ED9t concept"]},null,8,["modelValue","rules"]),o(U,{modelValue:e.formData.metadata.conceptDescription,"onUpdate:modelValue":t[8]||(t[8]=i=>e.formData.metadata.conceptDescription=i),filled:"",label:"Concepts Description",rules:[i=>!!i||"Vui l\xF2ng nh\u1EADp Concepts Description"]},null,8,["modelValue","rules"]),o(U,{modelValue:e.formData.explanation,"onUpdate:modelValue":t[9]||(t[9]=i=>e.formData.explanation=i),filled:"",label:"Gi\u1EA3i th\xEDch \u0111\xE1p \xE1n",rules:[i=>!!i||"Vui l\xF2ng nh\u1EADp gi\u1EA3i th\xEDch \u0111\xE1p \xE1n"]},null,8,["modelValue","rules"])])]),_:1},8,["onSubmit"])}var Tl=G(Cl,[["render",Vl]]);const Ql="object",Sl={id:{type:"string"},type:{type:"string",enum:["multiple_response","true_false","multiple_choice"]},question:{type:"string"},image:{type:"string"},options:{type:"array",items:{type:"object",properties:{text:{type:"string"},isCorrect:{type:"boolean"},image:{type:"string"}},required:["text","isCorrect"]}},metadata:{type:"object",properties:{bloomTaxonomy:{type:"string",enum:["remembering","understanding","applying"]},concepts:{type:"array",items:{type:"string"}},conceptDescription:{type:"string"},timeLimit:{type:"integer"},difficulty:{type:"string",enum:["very easy","easy","medium","hard"]}},required:["bloomTaxonomy","concepts","difficulty"]},explanation:{type:"string"}},Il=["id","type","question","options","metadata","explanation"];var Al={type:Ql,properties:Sl,required:Il};const Rl={name:"EditableQuestion",components:{GeneralQuestion:bl,EditQuestionForm:Tl},props:{questionData:{type:Object,required:!0},questionNumber:{type:Number,required:!0},showCorrectAnswer:{type:Boolean,default:!1},showFeedback:{type:Boolean,default:!1}},emits:["update:questionData","answer-selected"],setup(l,{emit:t}){const n=Ce(),e=C(!1),f=C(!1),m=C(!1),i=C({}),a=C(null),s=C(!1),c=C([]),y=["C\u1EADp nh\u1EADt n\u1ED9i dung c\xE2u h\u1ECFi","C\u1EADp nh\u1EADt \u0111\xE1p \xE1n","C\u1EADp nh\u1EADt h\xECnh \u1EA3nh","C\u1EADp nh\u1EADt \u0111\xE1p \xE1n \u0111\xFAng","C\u1EADp nh\u1EADt ph\u1EA3n h\u1ED3i"],u=B(()=>({questionData:l.questionData,questionNumber:l.questionNumber,showCorrectAnswer:l.showCorrectAnswer,showFeedback:l.showFeedback}));N(()=>l.questionData,g=>{console.log("Question data changed:",g),i.value=pe.cloneDeep(g)},{immediate:!0,deep:!0});const p=()=>{e.value=!0},h=g=>{var R,z,Q,H,M,le,X,ne,Y,ae;return c.value=[],(R=g.question)!=null&&R.trim()||c.value.push("N\u1ED9i dung c\xE2u h\u1ECFi kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),g.type||c.value.push("Lo\u1EA1i c\xE2u h\u1ECFi kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),(z=g.metadata)!=null&&z.bloomTaxonomy||c.value.push("Bloom Taxonomy kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),(!Array.isArray((Q=g.metadata)==null?void 0:Q.concepts)||g.metadata.concepts.length===0)&&c.value.push("Ph\u1EA3i c\xF3 \xEDt nh\u1EA5t m\u1ED9t concept"),(M=(H=g.metadata)==null?void 0:H.conceptDescription)!=null&&M.trim()||c.value.push("M\xF4 t\u1EA3 concept kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),(le=g.explanation)!=null&&le.trim()||c.value.push("Gi\u1EA3i th\xEDch \u0111\xE1p \xE1n kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),["multiple_choice","multiple_response","true_false"].includes(g.type)&&(!Array.isArray(g.options)||g.options.length<2?c.value.push("Ph\u1EA3i c\xF3 \xEDt nh\u1EA5t 2 \u0111\xE1p \xE1n"):(g.options.some(T=>{var F;return!((F=T.text)!=null&&F.trim())})&&c.value.push("C\xE1c \u0111\xE1p \xE1n kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng"),g.options.some(T=>T.isCorrect)||c.value.push("Ph\u1EA3i c\xF3 \xEDt nh\u1EA5t 1 \u0111\xE1p \xE1n \u0111\xFAng"))),g.type==="short_answer"&&((ne=(X=g.correctCriteria)==null?void 0:X.value)!=null&&ne.trim()||c.value.push("\u0110\xE1p \xE1n \u0111\xFAng kh\xF4ng \u0111\u01B0\u1EE3c \u0111\u1EC3 tr\u1ED1ng")),g.type==="matching"&&(!Array.isArray(g.options)||g.options.length<2?c.value.push("Ph\u1EA3i c\xF3 \xEDt nh\u1EA5t 2 c\u1EB7p gh\xE9p n\u1ED1i"):g.options.some(w=>{var T,F;return!((T=w.text)!=null&&T.trim())||!((F=w.match)!=null&&F.trim())})&&c.value.push("C\xE1c c\u1EB7p gh\xE9p n\u1ED1i ph\u1EA3i \u0111\u1EA7y \u0111\u1EE7 c\u1EA3 hai ph\u1EA7n")),g.type==="sequence"&&(!Array.isArray(g.options)||g.options.length<2?c.value.push("Ph\u1EA3i c\xF3 \xEDt nh\u1EA5t 2 m\u1EE5c \u0111\u1EC3 s\u1EAFp x\u1EBFp"):g.options.some(w=>{var T;return!((T=w.text)!=null&&T.trim())||!w.order})&&c.value.push("C\xE1c m\u1EE5c ph\u1EA3i c\xF3 n\u1ED9i dung v\xE0 th\u1EE9 t\u1EF1")),g.type==="numeric"&&((!((Y=g.correctCriteria)!=null&&Y.value)||!Array.isArray(g.correctCriteria.value)||g.correctCriteria.value.length!==2)&&c.value.push("Ph\u1EA3i c\xF3 \u0111\u1EE7 gi\xE1 tr\u1ECB nh\u1ECF nh\u1EA5t v\xE0 l\u1EDBn nh\u1EA5t cho c\xE2u h\u1ECFi s\u1ED1"),(((ae=g.correctCriteria)==null?void 0:ae.tolerance)===void 0||g.correctCriteria.tolerance<0)&&c.value.push("Sai s\u1ED1 ph\u1EA3i l\u1EDBn h\u01A1n ho\u1EB7c b\u1EB1ng 0")),Ne(g,Al)||c.value.push("D\u1EEF li\u1EC7u kh\xF4ng kh\u1EDBp v\u1EDBi schema y\xEAu c\u1EA7u. Vui l\xF2ng ki\u1EC3m tra l\u1EA1i c\xE1c tr\u01B0\u1EDDng b\u1EAFt bu\u1ED9c."),c.value.length===0};return{editing:e,saving:f,showConfirmDialog:m,editedQuestionData:i,editQuestion:p,saveChanges:()=>{console.log("Saving changes with data:",i.value),h(i.value)?(a.value=null,m.value=!0):s.value=!0},confirmSave:async()=>{if(!a.value){n.notify({type:"warning",message:"Vui l\xF2ng ch\u1ECDn l\xFD do thay \u0111\u1ED5i"});return}try{f.value=!0,m.value=!1;const g=pe.cloneDeep(i.value);console.log("Emitting update with:",{question:g,changeReason:a.value}),t("update:questionData",{question:g,changeReason:a.value}),e.value=!1,n.notify({color:"positive",message:"\u0110\xE3 l\u01B0u thay \u0111\u1ED5i th\xE0nh c\xF4ng"})}catch(g){console.error("Error saving question:",g),n.notify({color:"negative",message:"C\xF3 l\u1ED7i x\u1EA3y ra khi l\u01B0u thay \u0111\u1ED5i"})}finally{f.value=!1,a.value=null}},validateJsonAgainstSchema:Ne,questionProps:u,handleAnswerSelected:g=>{t("answer-selected",g)},changeReason:a,changeReasonOptions:y,showValidationErrors:s,validationErrors:c}}},zl={class:"editable-question-wrapper"},Ol={class:"edit-icon-wrapper"};function Ul(l,t,n,e,f,m){const i=E("GeneralQuestion"),a=E("EditQuestionForm");return d(),x("div",zl,[b("div",Ol,[o(k,{class:"edit-button",round:"",dense:"",flat:"",icon:"edit",onClick:e.editQuestion,"aria-label":"Ch\u1EC9nh s\u1EEDa c\xE2u h\u1ECFi"},null,8,["onClick"])]),o(i,Ye(e.questionProps,{onAnswerSelected:e.handleAnswerSelected}),null,16,["onAnswerSelected"]),o(se,{modelValue:e.editing,"onUpdate:modelValue":t[1]||(t[1]=s=>e.editing=s),persistent:""},{default:r(()=>[o(K,{style:{width:"70vw","max-width":"800px"}},{default:r(()=>[o(O,{class:"row items-center q-pb-none"},{default:r(()=>[t[5]||(t[5]=b("div",{class:"text-h6"},"Ch\u1EC9nh s\u1EEDa c\xE2u h\u1ECFi",-1)),o(Se),W(o(k,{icon:"close",flat:"",round:"",dense:""},null,512),[[oe]])]),_:1}),o(O,{class:"q-pa-md"},{default:r(()=>[o(a,{modelValue:e.editedQuestionData,"onUpdate:modelValue":t[0]||(t[0]=s=>e.editedQuestionData=s),questionType:n.questionData.type},null,8,["modelValue","questionType"])]),_:1}),o(ce,{align:"right",class:"q-pa-md"},{default:r(()=>[W(o(k,{flat:"",label:"H\u1EE7y",color:"negative"},null,512),[[oe]]),o(k,{loading:e.saving,label:"L\u01B0u thay \u0111\u1ED5i",color:"primary",onClick:e.saveChanges},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(se,{modelValue:e.showConfirmDialog,"onUpdate:modelValue":t[3]||(t[3]=s=>e.showConfirmDialog=s),persistent:""},{default:r(()=>[o(K,{style:{"min-width":"350px"}},{default:r(()=>[o(O,{class:"row items-center"},{default:r(()=>t[6]||(t[6]=[b("span",{class:"text-h6"},"X\xE1c nh\u1EADn thay \u0111\u1ED5i",-1)])),_:1}),o(O,{class:"q-pt-none"},{default:r(()=>[o(J,{modelValue:e.changeReason,"onUpdate:modelValue":t[2]||(t[2]=s=>e.changeReason=s),options:e.changeReasonOptions,label:"L\xFD do thay \u0111\u1ED5i",outlined:"",class:"q-mb-md",rules:[s=>!!s||"Vui l\xF2ng ch\u1ECDn l\xFD do thay \u0111\u1ED5i"]},null,8,["modelValue","options","rules"]),t[7]||(t[7]=b("span",{class:"text-caption"},"B\u1EA1n c\xF3 ch\u1EAFc ch\u1EAFn mu\u1ED1n l\u01B0u c\xE1c thay \u0111\u1ED5i?",-1))]),_:1}),o(ce,{align:"right"},{default:r(()=>[W(o(k,{flat:"",label:"H\u1EE7y",color:"negative"},null,512),[[oe]]),o(k,{flat:"",label:"X\xE1c nh\u1EADn",color:"primary",onClick:e.confirmSave,disable:!e.changeReason},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(se,{modelValue:e.showValidationErrors,"onUpdate:modelValue":t[4]||(t[4]=s=>e.showValidationErrors=s)},{default:r(()=>[o(K,{style:{"min-width":"400px"}},{default:r(()=>[o(O,null,{default:r(()=>t[8]||(t[8]=[b("div",{class:"text-h6"},"L\u1ED7i d\u1EEF li\u1EC7u",-1)])),_:1}),o(O,{class:"q-pt-none"},{default:r(()=>[(d(!0),x(Z,null,$(e.validationErrors,(s,c)=>(d(),x("div",{key:c,class:"text-negative q-mb-sm"},L(s),1))),128))]),_:1}),o(ce,{align:"right"},{default:r(()=>[W(o(k,{flat:"",label:"\u0110\xF3ng",color:"primary"},null,512),[[oe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Bl=G(Rl,[["render",Ul],["__scopeId","data-v-00d59666"]]);const El={name:"DocUploadConfirm",props:{docId:{type:String,required:!0},docType:{type:String,required:!0},showDialog:{type:Boolean,required:!0}},emits:["upload-confirmed","update:showDialog"],setup(l,{emit:t}){const n=Ce(),e=C(""),f=C(""),m=C(!1),i=C(!1),a=C(""),s=B({get:()=>l.showDialog,set:I=>t("update:showDialog",I)}),c=ct(),y=$e(),u=dt(),p=Te(),{user:h}=Qe(c),q=B(()=>{var I,R,z,Q;return(((R=(I=h.value)==null?void 0:I.role)==null?void 0:R.includes("editor"))||((Q=(z=h.value)==null?void 0:z.role)==null?void 0:Q.includes("admin")))&&f.value.trim()!=""&&e.value===l.docId}),v=()=>{g(),t("update:showDialog",!1)},_=async()=>{var I,R;m.value=!0,a.value="",i.value=!1;try{if(!((I=c.user)!=null&&I.name)||!((R=c.user)!=null&&R.uid))throw new Error("Th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng kh\xF4ng h\u1EE3p l\u1EC7");const z={name:c.user.name,uid:c.user.uid};let Q;switch(l.docType){case"lessonInfo":Q=u.lessonInfo;break;case"lessonPlan":Q=u.lessonPlan;break;case"lessonQuiz":Q=p.quizFullData;break;case"levelQuiz":Q=p.quizFullData;break;case"semesterQuiz":Q=p.quizFullData;break;default:throw new Error(`Invalid docType: ${l.docType}`)}if(!Q)throw new Error("Invalid document type or data not found.");if(l.docType==="lessonInfo"||l.docType==="lessonPlan"){if(!u.lessonCode)throw new Error("Lesson code not found!");await y.preparePackage(u.lessonCode,l.docType,f.value,z,Q)}else if(l.docType==="lessonQuiz"||l.docType==="levelQuiz"||l.docType==="semesterQuiz"){if(!l.docId)throw new Error("Quiz ID not found!");await y.prepareQuizPackage(l.docId,z,Q,f.value)}await y.pushPackageToFirestore(),i.value=!0,n.notify({color:"positive",message:"Upload th\xE0nh c\xF4ng!"}),t("upload-confirmed"),setTimeout(()=>{t("update:showDialog",!1)},1500)}catch(z){console.error("L\u1ED7i khi upload:",z),a.value=z.message||"C\xF3 l\u1ED7i x\u1EA3y ra khi upload."}finally{m.value=!1,g()}},g=()=>{e.value="",f.value="",i.value=!1};return{confirmDocId:e,updateDescription:f,isUploading:m,uploadSuccess:i,uploadError:a,isUploadAllowed:q,handleCancel:v,handleUpload:_,dialogModel:s}}},Nl={key:0,class:"q-mt-md text-negative"};function Ll(l,t,n,e,f,m){return d(),V(se,{modelValue:e.dialogModel,"onUpdate:modelValue":t[2]||(t[2]=i=>e.dialogModel=i),persistent:""},{default:r(()=>[o(K,{style:{"min-width":"350px"}},{default:r(()=>[o(O,null,{default:r(()=>t[3]||(t[3]=[b("div",{class:"text-h6"},"X\xE1c nh\u1EADn Upload Document",-1)])),_:1}),o(O,null,{default:r(()=>[b("p",null,"Lo\u1EA1i Document: "+L(n.docType),1),b("p",null,"M\xE3 Document: "+L(n.docId),1),o(U,{modelValue:e.confirmDocId,"onUpdate:modelValue":t[0]||(t[0]=i=>e.confirmDocId=i),label:"Nh\u1EADp Document ID \u0111\u1EC3 x\xE1c nh\u1EADn",rules:[i=>i===n.docId||"Document ID kh\xF4ng kh\u1EDBp"],class:"q-mt-md"},null,8,["modelValue","rules"]),o(U,{modelValue:e.updateDescription,"onUpdate:modelValue":t[1]||(t[1]=i=>e.updateDescription=i),label:"M\xF4 t\u1EA3 c\u1EADp nh\u1EADt",type:"textarea",class:"q-mt-md"},null,8,["modelValue"]),e.uploadError?(d(),x("div",Nl,L(e.uploadError),1)):A("",!0),e.isUploading?(d(),V(Vt,{key:1,indeterminate:"",color:"primary"})):A("",!0)]),_:1}),o(ce,{align:"right"},{default:r(()=>[o(k,{flat:"",label:"H\u1EE7y",color:"primary",onClick:e.handleCancel},null,8,["onClick"]),o(k,{flat:"",label:"Upload",color:"primary",disable:!e.isUploadAllowed,onClick:e.handleUpload},null,8,["disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Pl=G(El,[["render",Ll]]);const Ml={__name:"BarChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"bar",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},Hl={__name:"PieChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"pie",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},Fl={__name:"LineChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"line",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},jl={__name:"AreaChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"area",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},Kl={__name:"ColumnChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"column",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},Gl={__name:"TreeMapChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"treemap",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}},Xl={__name:"DonutChart",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},setup(l){const t=l,n=C(0);return N([()=>t.chartData,()=>t.options],()=>{n.value++},{deep:!0}),(e,f)=>{const m=E("apexchart");return l.chartData.length>0&&l.options?(d(),V(m,{type:"donut",options:l.options,series:l.chartData,key:n.value,height:"350"},null,8,["options","series"])):A("",!0)}}};const Yl={class:"q-mb-lg"},Jl={class:"q-mb-sm",style:{"font-size":"1.02rem"}},Wl={key:1},Zl={key:0},$l={key:1},ea={key:2},ta={__name:"DataStatistics",props:{data:{type:Object,required:!0,default:()=>({}),validator:l=>typeof l=="object"&&l!==null&&Object.values(l).every(t=>t&&t._custom&&t._custom.value||typeof t=="object"&&t!==null)},fields:{type:Array,required:!0,default:()=>[],validator:l=>Array.isArray(l)&&l.every(t=>t&&t.name&&t.chartType)}},setup(l){const t=l;mt((u,p,h)=>(console.error("DataStatistics Error:",u),console.error("Component:",p),console.error("Info:",h),!1));const n={bar:Ml,pie:Hl,line:Fl,area:jl,column:Kl,treemap:Gl,donut:Xl,number:Qt},e={bloomTaxonomy:"M\u1EE9c \u0111\u1ED9 nh\u1EADn th\u1EE9c",difficulty:"\u0110\u1ED9 kh\xF3",concepts:"Kh\xE1i ni\u1EC7m"},f=(u,p)=>{if(!u||!p)return{};const h={},q=Object.keys(u).length;return p.forEach(v=>{if(!v||!v.name)return;h[v.name]={stats:{}};const _=h[v.name].stats;Object.values(u).forEach(R=>{var H;const z=((H=R._custom)==null?void 0:H.value)||R,Q=v.name==="concepts"?typeof z[v.name]=="string"?z[v.name].split(",").map(M=>M.trim()).filter(Boolean):Array.isArray(z[v.name])?z[v.name]:[]:z[v.name];Array.isArray(Q)?Q.forEach(M=>{M&&(_[M]=_[M]?{count:_[M].count+1}:{count:1})}):Q&&(_[Q]=_[Q]?{count:_[Q].count+1}:{count:1})}),h[v.name].stats=a(_,q,v.name);const{chartData:g,options:I}=s(h[v.name].stats,v.chartType);h[v.name].chartData=g,h[v.name].options=I}),h},m=B(()=>f(t.data,t.fields)),i=u=>{var q,v,_,g,I,R,z,Q;const p=(q=m.value)==null?void 0:q[u];if(!(p!=null&&p.chartData))return!1;const h=(v=t.fields.find(H=>H.name===u))==null?void 0:v.chartType;return h?["bar","column","line","area"].includes(h)?Array.isArray(p.chartData)&&((g=(_=p.chartData[0])==null?void 0:_.data)==null?void 0:g.length)>0:["pie","donut","number"].includes(h)?Array.isArray(p.chartData)&&p.chartData.length>0&&((R=(I=p.options)==null?void 0:I.labels)==null?void 0:R.length)===p.chartData.length:h==="treemap"?Array.isArray(p.chartData)&&((Q=(z=p.chartData[0])==null?void 0:z.data)==null?void 0:Q.length)>0:!1:!1},a=(u,p,h)=>!u||typeof u!="object"?{}:Object.entries(u).reduce((v,[_,g])=>(g&&typeof g.count=="number"&&g.count>=0&&(v[_]={count:g.count,percentage:Math.round(g.count/p*100)}),v),{}),s=(u,p)=>{if(!u||Object.keys(u).length===0)return{chartData:[],options:c(p)};const h=Object.entries(u).map(([v,_])=>({name:v,y:_.count||0})).filter(v=>v.y>0);if(h.length===0)return{chartData:[],options:c(p)};const q={noData:{text:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#888",fontSize:"14px"}}};switch(p){case"bar":case"column":case"line":case"area":return{chartData:[{data:h.map(v=>({x:v.name,y:v.y}))}],options:{chart:{type:p},xaxis:{categories:h.map(v=>v.name)},...q}};case"number":return{chartData:h.map(v=>v.y),options:{chart:{type:p},labels:h.map(v=>v.name),series:h.map(v=>v.y)}};case"pie":case"donut":return{chartData:h.map(v=>v.y),options:{chart:{type:p},labels:h.map(v=>v.name),series:h.map(v=>v.y),...q}};case"treemap":return{chartData:[{data:h}],options:{chart:{type:p},...q}};default:return console.warn(`Unsupported chart type: ${p}`),{chartData:[],options:c(p)}}},c=u=>({chart:{type:u},noData:{text:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u",align:"center",verticalAlign:"middle",offsetX:0,offsetY:0,style:{color:"#888",fontSize:"14px"}}}),y=u=>{var h,q;const p=(q=(h=m.value)==null?void 0:h[u])==null?void 0:q.stats;return p?Object.fromEntries(Object.entries(p).sort(([,v],[,_])=>(_.count||0)-(v.count||0))):{}};return(u,p)=>(d(),V(be,{separator:"",class:"col q-mt-md"},{default:r(()=>[(d(!0),x(Z,null,$(l.fields,h=>(d(),V(K,{flat:"",key:h.name,class:"col-xs-12 col-sm-6 col-md-6 col-lg-4 apex-chart"},{default:r(()=>[b("div",Yl,[b("div",Jl,L(e[h.name]||h.name),1),b("div",null,[m.value[h.name]&&i(h.name)&&n[h.chartType]?(d(),V(ke(n[h.chartType]),{key:0,"chart-data":m.value[h.name].chartData,options:m.value[h.name].options},null,8,["chart-data","options"])):m.value[h.name]?(d(),x("div",Wl,[Object.keys(m.value[h.name].stats||{}).length>0?(d(),x("div",Zl,[(d(!0),x(Z,null,$(y(h.name),(q,v)=>(d(),x("div",{key:v,class:"q-mb-sm"},[o(k,{unelevated:"",flat:"",dense:"",label:`${v}: ${q.count} (${q.percentage}%)`},null,8,["label"])]))),128))])):(d(),x("div",$l,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u th\u1ED1ng k\xEA"))])):(d(),x("div",ea,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u th\u1ED1ng k\xEA"))])])]),_:2},1024))),128))]),_:1}))}},la={components:{DataStatistics:ta},emits:["quiz-submit"],setup(l,{emit:t}){const n=Te(),{quizBasicInfo:e,quizStatistics:f,selectedQuestionIds:m,selectedQuestionsById:i,selectedQuestionsStatistics:a,quizQuestions:s,quizFullData:c,simplifiedSelectedQuestions:y}=Qe(n),u=()=>{const le=new Date,X={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return le.toLocaleTimeString("en-GB",X).replace(/[/,\s:]/g,"")},p=C([{label:"TEKY",value:"TEKY"}]),h=C([{label:"UARO",value:"UARO"},{label:"MAKER EMPIRE",value:"MAKER_EMPIRE"},{label:"SCRATCH .JR",value:"SCRATCH_JR"},{label:"KITTEN .JR",value:"KITTEN_JR"},{label:"SCRATCH",value:"SCRATCH"},{label:"CODE KITTEN",value:"CODE_KITTEN"},{label:"TYNKER",value:"TYNKER"},{label:"MAKECODE",value:"MAKECODE"},{label:"PICTOBLOX",value:"PICTOBLOX"},{label:"WHALESBOT",value:"WHALESBOT"},{label:"LEGO SPIKE PRIME",value:"SPIKE_PRIME"},{label:"LEGO SPIKE ESSENTIAL",value:"SPIKE_ESSENTIAL"},{label:"LEGO WEDO 2.0",value:"WEDO_2"},{label:"LEGO MINDSTORMS EV3",value:"MINDSTORMS_EV3"},{label:"MICROBIT",value:"MICROBIT"},{label:"ARDUINO",value:"ARDUINO"},{label:"RASPBERRY PI PICO",value:"PI_PICO"},{label:"PYTHON",value:"PYTHON"},{label:"SWIFT",value:"SWIFT"},{label:"JAVASCRIPT",value:"JAVASCRIPT"},{label:"LUA",value:"LUA"},{label:"ROBLOX",value:"ROBLOX"},{label:"UNITY",value:"UNITY"},{label:"C++",value:"C++"},{label:"C#",value:"C#"},{label:"TINKERCAD",value:"TINKERCAD"},{label:"PHOTOSHOP",value:"PHOTOSHOP"},{label:"GIMP",value:"GIMP"},{label:"ILLUSTRATOR",value:"ILLUSTRATOR"},{label:"INKSCAPE",value:"INKSCAPE"},{label:"PREMIERE",value:"PREMIERE"},{label:"CANVA",value:"CANVA"}]),q=C([{label:"Lesson Quiz",value:"lessonQuiz"},{label:"Level Quiz",value:"levelQuiz"},{label:"Semester Quiz",value:"semesterQuiz"}]),v=C([{name:"bloomTaxonomy",chartType:"number"},{name:"difficulty",chartType:"number"},{name:"concepts",chartType:"donut"}]),_=C([{label:"M\u1EA7m Non C\xF4ng Ngh\u1EC7",value:"MNCN"},{label:"B\xE9 L\xE0m Game",value:"BLG"},{label:"B\xE9 L\xE0m Game AI",value:"BLG_AI"},{label:"Kh\xE1m Ph\xE1 Robotics",value:"KPRB"},{label:"Ph\xE1m Ph\xE1 Robotics Spike",value:"KPRB_SPIKE"},{label:"Ph\xE1m Ph\xE1 Robotics AI",value:"KPRB_AI"},{label:"Digi-STEM Art",value:"DIGIART"},{label:"DigiStyle-Multimedia",value:"DIGISTYLE"},{label:"Si\xEAu Nh\xE2n L\u1EADp Tr\xECnh App",value:"SNLTA"},{label:"Si\xEAu Nh\xE2n L\u1EADp Tr\xECnh Web",value:"SNLTW"},{label:"Si\xEAu Nh\xE2n L\xE0m Game",value:"SNLG"},{label:"Th\u1EBF Gi\u1EDBi V\u1EA1n V\u1EADt Th\xF4ng Minh IoT",value:"TGVVTM"},{label:"C\xF4ng Ngh\u1EC7 L\u1EADp Tr\xECnh App",value:"CNLTA"},{label:"C\xF4ng Ngh\u1EC7 L\u1EADp Tr\xECnh Web",value:"CNLTW"},{label:"C\xF4ng Ngh\u1EC7 Game",value:"CNG"},{label:"C\xF4ng Ngh\u1EC7 IoT ",value:"CNIOT"},{label:"Thi\u1EBFt K\u1EBF Truy\u1EC1n Th\xF4ng",value:"TKTT"}]),g=C([{label:"H\u1ECDc ph\u1EA7n 1",value:"HP01"},{label:"H\u1ECDc ph\u1EA7n 2",value:"HP02"},{label:"H\u1ECDc ph\u1EA7n 3",value:"HP03"},{label:"H\u1ECDc ph\u1EA7n 4",value:"HP04"},{label:"H\u1ECDc ph\u1EA7n 5",value:"HP05"},{label:"H\u1ECDc ph\u1EA7n 6",value:"HP06"},{label:"H\u1ECDc ph\u1EA7n 7",value:"HP07"},{label:"H\u1ECDc ph\u1EA7n 8",value:"HP08"},{label:"H\u1ECDc ph\u1EA7n 9",value:"HP09"},{label:"H\u1ECDc ph\u1EA7n 10",value:"HP10"},{label:"H\u1ECDc ph\u1EA7n 11",value:"HP11"},{label:"H\u1ECDc ph\u1EA7n 12",value:"HP12"}]),I=C([{label:"B\xE0i 1",value:"B01"},{label:"B\xE0i 2",value:"B02"},{label:"B\xE0i 3",value:"B03"},{label:"B\xE0i 4",value:"B04"},{label:"B\xE0i 5",value:"B05"},{label:"B\xE0i 6",value:"B06"},{label:"B\xE0i 7",value:"B07"},{label:"B\xE0i 8",value:"B08"},{label:"B\xE0i 9",value:"B09"},{label:"B\xE0i 10",value:"B10"},{label:"B\xE0i 11",value:"B11"},{label:"B\xE0i 12",value:"B12"}]),R=B(()=>n.quizTypes[e.value.type]||{}),z=B(()=>e.value.type?e.value.duration>=R.value.minDuration&&e.value.duration<=R.value.maxDuration:!0);N([()=>e.value.category,()=>e.value.type,()=>e.value.school,()=>e.value.course,()=>e.value.level,()=>e.value.lesson],([le,X,ne,Y,ae,de],[w,T,F,j,ee])=>{switch(X){case"lessonQuiz":e.value.id=`${X}-${ne}-${Y}-${ae}-${de}`;break;case"levelQuiz":e.value.id=`${X}-${ne}-${Y}-${ae}-ALL`;break;case"semesterQuiz":e.value.id=`${X}-${ne}-${Y}-${le}-ALL`;break;default:throw new Error("Invalid quiz type")}});const Q=B(()=>e.value.type?f.value.questionCount>=R.value.minQuestion&&f.value.questionCount<=R.value.maxQuestion:!0);return{selectedQuestionIds:m,quizBasicInfo:e,quizStatistics:f,quizQuestions:s,lessonOptions:I,quizFullData:c,quizTypeOptions:q,courseOptions:_,levelOptions:g,selectedQuestionsById:i,selectedQuestionsStatistics:a,categoryOptions:h,statisticsFields:v,simplifiedSelectedQuestions:y,quizTypeConfig:R,isValidDuration:z,isValidQuestionCount:Q,removeGlossary:le=>{},onSubmit:()=>{if(!Q.value){console.error("Invalid number of questions selected for this quiz type.");return}n.quizQuestions=n.selectedQuestionsById,console.log("Try to submit quiz!"),t("quiz-submit")},schoolOptions:p,getCurrentDateTimeString:u}}},aa={class:"row q-col-gutter-md"},oa={class:"col-12"},na={class:"col-12"},ia={class:"row q-gutter-x-sm col-12"},sa={class:"col"},ra={class:"col"},ua={class:"col"},ca={key:0,class:"col-12 q-mb-md"},da={class:"row q-gutter-x-sm col-12"},ma={class:"col"},pa={class:"col"},ha={class:"row q-gutter-x-sm col-12"},fa={key:0,class:"col"},ga={key:1,class:"col"},va={class:"col-12"},ya={class:"col-12"},ba={class:"col-12 q-mt-md"},Ca={class:"q-mt-sm q-gutter-sm"},wa={class:"col-12 q-mt-md"};function _a(l,t,n,e,f,m){const i=E("DataStatistics");return d(),V(tt,{onSubmit:ge(e.onSubmit,["prevent"]),class:"q-pa-md"},{default:r(()=>[b("div",aa,[b("div",oa,[o(k,{label:"Submit",type:"submit",color:"primary",class:"full-width",unelevated:"",disable:!e.isValidQuestionCount},null,8,["disable"])]),o(De,{icon:"info",label:"Quiz Basic Info",class:"col-12","default-opened":""},{default:r(()=>[b("div",na,[o(U,{filled:"",modelValue:e.quizBasicInfo.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.quizBasicInfo.title=a),label:"Quiz Title",rules:[a=>!!a||"Quiz Title is required"]},null,8,["modelValue","rules"])]),b("div",ia,[b("div",sa,[o(J,{filled:"",modelValue:e.quizBasicInfo.category,"onUpdate:modelValue":t[1]||(t[1]=a=>e.quizBasicInfo.category=a),options:e.categoryOptions,label:"Quiz Category",rules:[a=>!!a||"Quiz Category is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),b("div",ra,[o(J,{filled:"",modelValue:e.quizBasicInfo.type,"onUpdate:modelValue":t[2]||(t[2]=a=>e.quizBasicInfo.type=a),options:e.quizTypeOptions,label:"Quiz Type",rules:[a=>!!a||"Quiz Type is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),b("div",ua,[o(U,{filled:"",modelValue:e.quizBasicInfo.duration,"onUpdate:modelValue":t[3]||(t[3]=a=>e.quizBasicInfo.duration=a),modelModifiers:{number:!0},label:"Quiz Duration",type:"number",min:e.quizTypeConfig.minDuration,max:e.quizTypeConfig.maxDuration,rules:[a=>!!a||"Quiz Duration is required",a=>e.isValidDuration||`Duration must be between ${e.quizTypeConfig.minDuration} and ${e.quizTypeConfig.maxDuration} minutes`],disable:!e.quizBasicInfo.type},null,8,["modelValue","min","max","rules","disable"])]),e.quizBasicInfo.type?(d(),x("div",ca," S\u1ED1 l\u01B0\u1EE3ng: ["+L(e.quizTypeConfig.minQuestion)+" - "+L(e.quizTypeConfig.maxQuestion)+"] c\xE2u h\u1ECFi. \u0110\xE3 ch\u1ECDn "+L(e.selectedQuestionIds.length)+" c\xE2u h\u1ECFi. ",1)):A("",!0)]),b("div",da,[b("div",ma,[o(J,{filled:"",modelValue:e.quizBasicInfo.school,"onUpdate:modelValue":t[4]||(t[4]=a=>e.quizBasicInfo.school=a),options:e.schoolOptions,label:"School",rules:[a=>!!a||"School is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])]),b("div",pa,[o(J,{filled:"",modelValue:e.quizBasicInfo.course,"onUpdate:modelValue":t[5]||(t[5]=a=>e.quizBasicInfo.course=a),options:e.courseOptions,label:"Course",rules:[a=>!!a||"Course is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"])])]),b("div",ha,[e.quizBasicInfo.type!=="semesterQuiz"?(d(),x("div",fa,[o(J,{filled:"",modelValue:e.quizBasicInfo.level,"onUpdate:modelValue":t[6]||(t[6]=a=>e.quizBasicInfo.level=a),options:e.levelOptions,rules:[a=>!!a||"Level is required"],label:"Level","emit-value":"","map-options":""},null,8,["modelValue","options","rules"])])):A("",!0),e.quizBasicInfo.type==="lessonQuiz"||e.quizBasicInfo.type==="activityQuiz"?(d(),x("div",ga,[o(J,{filled:"",modelValue:e.quizBasicInfo.lesson,"onUpdate:modelValue":t[7]||(t[7]=a=>e.quizBasicInfo.lesson=a),options:e.lessonOptions,rules:[a=>!!a||"Lesson is required"],label:"Lesson","emit-value":"","map-options":""},null,8,["modelValue","options","rules"])])):A("",!0)]),b("div",va,[o(U,{filled:"",modelValue:e.quizBasicInfo.id,"onUpdate:modelValue":t[8]||(t[8]=a=>e.quizBasicInfo.id=a),label:"Quiz ID",rules:[a=>!!a||"Quiz ID is required"],readonly:""},null,8,["modelValue","rules"])]),b("div",ya,[o(U,{filled:"",modelValue:e.quizBasicInfo.description,"onUpdate:modelValue":t[9]||(t[9]=a=>e.quizBasicInfo.description=a),type:"textarea",label:"Quiz Description"},null,8,["modelValue"])])]),_:1}),o(De,{icon:"apps",label:"Quiz Glossary",class:"col-12","default-opened":""},{default:r(()=>{var a;return[b("div",ba,[b("div",Ca,[(d(!0),x(Z,null,$((a=e.selectedQuestionsStatistics)==null?void 0:a.glossaries,s=>(d(),V(Tt,{key:s,removable:"",onRemove:c=>e.removeGlossary(s)},{default:r(()=>[he(L(s),1)]),_:2},1032,["onRemove"]))),128))])])]}),_:1}),o(De,{icon:"bar_chart",label:"Quiz Statistics",class:"col-12","default-opened":""},{default:r(()=>[b("div",wa,[o(i,{data:e.simplifiedSelectedQuestions,fields:e.statisticsFields},null,8,["data","fields"])])]),_:1})])]),_:1},8,["onSubmit"])}var qa=G(la,[["render",_a]]);const Da={name:"QuestionEditor",components:{AdvancedTable:Mt,EditableQuestion:Bl,ImportDataButton:kt,QuizInfo:qa,DocUploadConfirm:Pl},setup(){const l=Te();$e();const{allQuestions:t,selectedCategories:n,availableCategories:e,selectedQuestionId:f,selectedQuestionsForPush:m,quizBasicInfo:i}=Qe(l),a=Ce(),s=C(!1),c=C(!1),y=C(null),u=C(!1),p=C(!1),h=C(null),q=C([]),v=C(!1),_=C(""),g=C(""),I=(D,S)=>{_.value=D,g.value=S,v.value=!0},R=()=>{console.log("Document uploaded!")},z=({data:D,dataType:S,config:P})=>{console.log(JSON.stringify(D)),quizStore.updateQuizData(D,quizInfoData.value.fullLevelCode)},Q=D=>{l.updateSelectedQuestions(D),console.log(JSON.stringify(l.selectedQuestionsById)),q.value=[],q.value=D},H=()=>{console.log("Try to open form");const S=l.quizFullData.id;I(i.value.type,S)},M=D=>{const S={id:`new_${Date.now()}`,type:D,question:"",options:[],metadata:{difficulty:"medium",bloomTaxonomy:"understand",concepts:[]},lastChange:{changeType:"create",changeReason:"T\u1EA1o c\xE2u h\u1ECFi m\u1EDBi",timestamp:Date.now()}};switch(D){case"multiple_choice":case"multiple_response":S.options=[{text:"",isCorrect:!1},{text:"",isCorrect:!1}];break;case"true_false":S.options=[{text:"\u0110\xFAng",isCorrect:!1},{text:"Sai",isCorrect:!1}];break;case"short_answer":S.correctCriteria={type:"exact",value:""};break;case"matching":S.options=[{text:"",match:""},{text:"",match:""}];break;case"sequence":S.options=[{text:"",order:1},{text:"",order:2}];break;case"numeric":S.correctCriteria={type:"range",value:[0,0],tolerance:0};break}y.value=S,a.notify({type:"positive",message:"\u0110\xE3 t\u1EA1o c\xE2u h\u1ECFi m\u1EDBi",position:"top"})},le=B(()=>{const D=Object.keys(l.changedQuestions).length,S=l.deletedQuestionIds.length;return console.log("Changed count:",D,"Deleted count:",S),D>0||S>0}),X=B(()=>Object.keys(l.changedQuestions).length+l.deletedQuestionIds.length),ne=B(()=>{var re;const D=[],S=[],P=l.deletedQuestionIds;for(const[ue,te]of Object.entries(l.changedQuestions))((re=te.lastChange)==null?void 0:re.changeType)==="create"?D.push(ue):S.push(ue);return{created:D.length,updated:S.length,deleted:P.length}}),Y=B({get:()=>m.value,set:D=>{console.log("Setting selectedQuestionsForPush:",D),l.updateSelectedQuestionsForPush(D)}}),ae=D=>D.map(S=>{var re,ue,te,Ae;const P=S._custom?S._custom.value:S;return{id:P.id,question:P.question,type:P.type,explanation:P.explanation,difficulty:((re=P.metadata)==null?void 0:re.difficulty)||"N/A",bloomTaxonomy:((ue=P.metadata)==null?void 0:ue.bloomTaxonomy)||"N/A",concepts:((Ae=(te=P.metadata)==null?void 0:te.concepts)==null?void 0:Ae.join(", "))||"N/A",lastChange:P.lastChange?`${P.lastChange.changeReason} (${_e(P.lastChange.timestamp.seconds)})`:"N/A"}}),de=B(()=>ae(l.allQuestions)),w=B(()=>{var S,P,re;console.log("Computing changedQuestionsTableData");const D=[];for(const[ue,te]of Object.entries(l.changedQuestions))D.push({id:te.id,question:te.question,type:te.type,changeType:((S=te.lastChange)==null?void 0:S.changeType)||"update",changeReason:((P=te.lastChange)==null?void 0:P.changeReason)||"N/A",timestamp:(re=te.lastChange)!=null&&re.timestamp?_e(te.lastChange.timestamp.seconds):"N/A"});for(const ue of l.deletedQuestionIds)D.push({id:ue,question:"\u0110\xE3 x\xF3a",type:"N/A",changeType:"delete",changeReason:"X\xF3a c\xE2u h\u1ECFi",timestamp:new Date().toLocaleString()});return console.log("Changed questions table data:",D),D}),T=[{name:"id",label:"ID C\xE2u H\u1ECFi",field:"id",sortable:!0,align:"left"},{name:"detail",label:"Chi ti\u1EBFt",field:"detail",align:"center"},{name:"question",label:"N\u1ED9i Dung C\xE2u H\u1ECFi",field:"question",sortable:!0,align:"left"},{name:"type",label:"Lo\u1EA1i C\xE2u H\u1ECFi",field:"type",sortable:!0,align:"left"},{name:"difficulty",label:"\u0110\u1ED9 Kh\xF3",field:"difficulty",sortable:!0,align:"left"},{name:"bloomTaxonomy",label:"Nh\u1EADn th\u1EE9c",field:"bloomTaxonomy",sortable:!0,align:"left"},{name:"concepts",label:"Kh\xE1i Ni\u1EC7m",field:"concepts",sortable:!1,align:"left"},{name:"lastChange",label:"Thay \u0111\u1ED5i cu\u1ED1i",field:"lastChange",sortable:!0,align:"left"},{name:"remove",label:"X\xF3a",field:"id",align:"center"}],F=[{name:"id",label:"ID C\xE2u H\u1ECFi",field:"id",sortable:!0,align:"left"},{name:"detail",label:"Chi ti\u1EBFt",field:"detail",align:"center"},{name:"question",label:"N\u1ED9i Dung C\xE2u H\u1ECFi",field:"question",sortable:!0,align:"left"},{name:"type",label:"Lo\u1EA1i C\xE2u H\u1ECFi",field:"type",sortable:!0,align:"left"},{name:"changeType",label:"Lo\u1EA1i Thay \u0110\u1ED5i",field:"changeType",sortable:!0,align:"left"},{name:"changeReason",label:"L\xFD Do",field:"changeReason",sortable:!0,align:"left"},{name:"timestamp",label:"Th\u1EDDi Gian",field:"timestamp",sortable:!0,align:"left"}],j={difficulty:{type:"select",options:[]},type:{type:"select",options:[]},bloomTaxonomy:{type:"select",options:[]}},ee=async()=>{if(!n.value.length){a.notify({type:"warning",message:"Vui l\xF2ng ch\u1ECDn \xEDt nh\u1EA5t m\u1ED9t danh m\u1EE5c",position:"top"});return}s.value=!0;try{await l.fetchQuestionsBySelectedCategory(),a.notify({type:"positive",message:"\u0110\xE3 t\u1EA3i d\u1EEF li\u1EC7u th\xE0nh c\xF4ng",position:"top"})}catch(D){console.error("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u:",D),a.notify({type:"negative",message:"C\xF3 l\u1ED7i x\u1EA3y ra khi t\u1EA3i d\u1EEF li\u1EC7u",position:"top"})}finally{s.value=!1}},ie=D=>{console.log("handleShowRowDetail called with:",D),f.value=D,y.value=l.getQuestionById(D)},me=({question:D,changeReason:S})=>{console.log("handleQuestionUpdate called with:",{question:D,changeReason:S}),l.markQuestionChanged({question:D,changeReason:S}),y.value=D,a.notify({type:"positive",message:`\u0110\xE3 c\u1EADp nh\u1EADt c\xE2u h\u1ECFi: ${S}`,position:"top"})},we=D=>{for(const S of D)me({question:S,changeReason:"T\u1EA1o m\u1EDBi c\xE2u h\u1ECFi v\u1EDBi AI"})},lt=D=>{console.log("confirmRemoveQuestion called with:",D),h.value=D,u.value=!0},at=()=>{var D;h.value&&(console.log("Confirming delete for question:",h.value),l.markQuestionDeleted(h.value.id),((D=y.value)==null?void 0:D.id)===h.value.id&&(y.value=null),a.notify({type:"info",message:`\u0110\xE3 \u0111\xE1nh d\u1EA5u x\xF3a c\xE2u h\u1ECFi ${h.value.id}`,position:"top"}),h.value=null)},ot=async()=>{if(console.log("handlePushToFirestore called"),!Y.value.length){a.notify({type:"warning",message:"Vui l\xF2ng ch\u1ECDn \xEDt nh\u1EA5t m\u1ED9t c\xE2u h\u1ECFi \u0111\u1EC3 push",position:"top"});return}c.value=!0;try{const D=await l.prepareFirestoreUpdate(n.value[0].value);a.notify({type:"positive",message:`\u0110\xE3 push th\xE0nh c\xF4ng ${Y.value.length} c\xE2u h\u1ECFi`,position:"top"}),p.value=!1}catch(D){console.error("L\u1ED7i khi push l\xEAn Firestore:",D),a.notify({type:"negative",message:"C\xF3 l\u1ED7i x\u1EA3y ra khi push l\xEAn Firestore",position:"top"})}finally{c.value=!1}};Xe(()=>{l.isInitialized||l.initializeStore()});function nt(){console.log("handleUploadSuccess called")}return{allQuestions:t,selectedCategories:n,availableCategories:e,tableColumns:T,reviewTableColumns:F,columnFilters:j,loadQuestions:ee,tableData:de,changedQuestionsTableData:w,handleShowRowDetail:ie,selectedQuestionData:y,loading:s,pushing:c,showDeleteConfirm:u,showReviewDialog:p,confirmRemoveQuestion:lt,handleConfirmDelete:at,handleQuestionUpdate:me,handlePushToFirestore:ot,changedStats:ne,totalChangedQuestions:X,hasChanges:le,selectedQuestions:Y,handleAddRow:M,handleImportComplete:z,selectedRows:q,handleSelectedRowsChanged:Q,simplifiedData:ae,handleQuizSubmit:H,showUploadDialog:v,selectedDocType:_,selectedDocId:g,openUploadDialog:I,handleUploadConfirmed:R,handleUploadSuccess:nt,handleDataUpdate:we,epochTimestampToDateString:_e}}},xa={class:"row"},ka={class:"col-12 col-md-8"},Va={class:"row q-col-gutter-md"},Ta={class:"col-12 col-sm-3"},Qa={class:"col-12 col-sm-3"},Sa={key:0,class:"text-center q-pa-md text-grey-8"},Ia={key:1,class:"text-center q-pa-md text-grey-8"},Aa={class:"row q-col-gutter-md"},Ra={class:"col-12 col-md-4"},za={class:"text-h4"},Oa={class:"col-12 col-md-4"},Ua={class:"text-h4"},Ba={class:"col-12 col-md-4"},Ea={class:"text-h4"},Na={class:"col-12 col-md-4"};function La(l,t,n,e,f,m){const i=E("ImportDataButton"),a=E("advanced-table"),s=E("EditableQuestion"),c=E("QuizInfo"),y=E("DocUploadConfirm");return d(),V(ft,{class:"question-editor"},{default:r(()=>[b("div",xa,[b("div",ka,[o(K,{flat:"",bordered:""},{default:r(()=>[o(O,null,{default:r(()=>[b("div",Va,[o(J,{modelValue:e.selectedCategories,"onUpdate:modelValue":t[0]||(t[0]=u=>e.selectedCategories=u),options:e.availableCategories,label:"Ch\u1ECDn danh m\u1EE5c",multiple:"",outlined:"",class:"col-12 col-sm-3"},null,8,["modelValue","options"]),o(i,{onImportComplete:e.handleImportComplete},null,8,["onImportComplete"]),b("div",Ta,[o(k,{color:"primary",label:"T\u1EA3i d\u1EEF li\u1EC7u",onClick:e.loadQuestions,class:"full-width full-height",icon:"download",loading:e.loading,unelevated:""},null,8,["onClick","loading"])]),b("div",Qa,[o(k,{color:"positive",label:"Push to Firestore",onClick:t[1]||(t[1]=u=>e.showReviewDialog=!0),class:"full-width full-height",icon:"cloud_upload",disable:!e.hasChanges,unelevated:""},{default:r(()=>[e.totalChangedQuestions?(d(),V(ht,{key:0,color:"red",floating:""},{default:r(()=>[he(L(e.totalChangedQuestions),1)]),_:1})):A("",!0)]),_:1},8,["disable"])])])]),_:1}),o(O,null,{default:r(()=>[e.selectedCategories.length?e.tableData.length?(d(),V(a,{key:2,data:e.tableData,columns:e.tableColumns,"column-filters":e.columnFilters,"enable-export":"",onRemoveRow:e.confirmRemoveQuestion,onShowRowDetail:e.handleShowRowDetail,onAddRow:e.handleAddRow,onSelectedRowsChanged:e.handleSelectedRowsChanged,"onUpdate:data":e.handleDataUpdate},null,8,["data","columns","column-filters","onRemoveRow","onShowRowDetail","onAddRow","onSelectedRowsChanged","onUpdate:data"])):(d(),x("div",Ia," Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u cho danh m\u1EE5c \u0111\xE3 ch\u1ECDn ")):(d(),x("div",Sa," Vui l\xF2ng ch\u1ECDn danh m\u1EE5c \u0111\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u "))]),_:1}),e.selectedQuestionData?(d(),V(O,{key:0},{default:r(()=>[o(s,{questionData:e.selectedQuestionData,questionNumber:1,showFeedback:"","onUpdate:questionData":e.handleQuestionUpdate},null,8,["questionData","onUpdate:questionData"])]),_:1})):A("",!0)]),_:1}),o(se,{modelValue:e.showDeleteConfirm,"onUpdate:modelValue":t[2]||(t[2]=u=>e.showDeleteConfirm=u),persistent:""},{default:r(()=>[o(K,null,{default:r(()=>[o(O,{class:"row items-center"},{default:r(()=>[o(pt,{icon:"warning",color:"warning","text-color":"white"}),t[6]||(t[6]=b("span",{class:"q-ml-sm"},"B\u1EA1n c\xF3 ch\u1EAFc ch\u1EAFn mu\u1ED1n x\xF3a c\xE2u h\u1ECFi n\xE0y?",-1))]),_:1}),o(ce,{align:"right"},{default:r(()=>[W(o(k,{flat:"",label:"H\u1EE7y",color:"primary"},null,512),[[oe]]),W(o(k,{flat:"",label:"X\xF3a",color:"negative",onClick:e.handleConfirmDelete},null,8,["onClick"]),[[oe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(se,{modelValue:e.showReviewDialog,"onUpdate:modelValue":t[4]||(t[4]=u=>e.showReviewDialog=u),persistent:"",maximized:""},{default:r(()=>[o(K,null,{default:r(()=>[o(O,{class:"row items-center"},{default:r(()=>[t[7]||(t[7]=b("div",{class:"text-h6"},"Review Changes",-1)),o(Se),W(o(k,{icon:"close",flat:"",round:"",dense:""},null,512),[[oe]])]),_:1}),o(O,null,{default:r(()=>[b("div",Aa,[b("div",Ra,[o(K,{class:"bg-green-1",flat:""},{default:r(()=>[o(O,null,{default:r(()=>[t[8]||(t[8]=b("div",{class:"text-h6"},"T\u1EA1o m\u1EDBi",-1)),b("div",za,L(e.changedStats.created),1)]),_:1})]),_:1})]),b("div",Oa,[o(K,{class:"bg-orange-1",flat:""},{default:r(()=>[o(O,null,{default:r(()=>[t[9]||(t[9]=b("div",{class:"text-h6"},"Ch\u1EC9nh s\u1EEDa",-1)),b("div",Ua,L(e.changedStats.updated),1)]),_:1})]),_:1})]),b("div",Ba,[o(K,{class:"bg-red-1",flat:""},{default:r(()=>[o(O,null,{default:r(()=>[t[10]||(t[10]=b("div",{class:"text-h6"},"X\xF3a",-1)),b("div",Ea,L(e.changedStats.deleted),1)]),_:1})]),_:1})])])]),_:1}),o(O,null,{default:r(()=>[o(a,{data:e.changedQuestionsTableData,columns:e.reviewTableColumns,"column-filters":e.columnFilters,selection:"multiple",modelValue:e.selectedQuestions,"onUpdate:modelValue":t[3]||(t[3]=u=>e.selectedQuestions=u),onShowRowDetail:e.handleShowRowDetail},null,8,["data","columns","column-filters","modelValue","onShowRowDetail"])]),_:1}),o(ce,{align:"right",class:"q-pa-md"},{default:r(()=>[W(o(k,{flat:"",label:"H\u1EE7y",color:"negative"},null,512),[[oe]]),o(k,{loading:e.pushing,disable:!e.selectedQuestions.length,label:"Push to Firestore",color:"primary",onClick:e.handlePushToFirestore},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),b("div",Na,[o(c,{onQuizSubmit:e.handleQuizSubmit},null,8,["onQuizSubmit"])])]),o(y,{showDialog:e.showUploadDialog,"onUpdate:showDialog":t[5]||(t[5]=u=>e.showUploadDialog=u),"doc-id":e.selectedDocId,"doc-type":e.selectedDocType,onUploadConfirmed:e.handleUploadSuccess},null,8,["showDialog","doc-id","doc-type","onUploadConfirmed"])]),_:1})}var xo=G(Da,[["render",La],["__scopeId","data-v-59bd7032"]]);export{xo as default};
