import{be as ve,bf as pe,r as s,k as w,o as be,X as r,Y as x,Z as l,q as t,ae as D,a7 as o,aN as Z,bs as Y,_ as y,L as J,a6 as T,ad as Q,a9 as h,a0 as p,$ as k,a1 as m,F as L,aa as O}from"./index.037f850d.js";import{Q as _e,a as ye}from"./QPopupProxy.aac1ad86.js";import{Q as he}from"./QSpinnerDots.6c974946.js";import{Q as I}from"./QTooltip.9f64b4d0.js";import{a as S,Q as xe,c as A,b as ke}from"./QTabPanels.d3e13bfb.js";import{Q as K,a as F}from"./QTable.3729fe60.js";import{Q as B,a as C,b as R}from"./QItem.a6e550b6.js";import{Q as z}from"./QBadge.c4b03a0c.js";import{Q as ee}from"./QList.80fe3cd0.js";import{Q as we}from"./QPage.a2da79f2.js";import{C as te}from"./ClosePopup.f7b4fda5.js";import{a as De}from"./axios.9ab26c22.js";import{u as Te}from"./use-quasar.414eeb3f.js";import{d as V}from"./date.3d27e200.js";import{_ as Qe}from"./ErrorBanner.ab53268a.js";import{_ as Ce}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-render-cache.3aae9b27.js";import"./format.8ac60962.js";import"./QSelect.70047d12.js";import"./rtl.ad3ba425.js";import"./selection.b5503321.js";import"./QResizeObserver.b97c3070.js";import"./touch.9135741d.js";import"./QMarkupTable.c24125e0.js";import"./QLinearProgress.f467e272.js";import"./use-fullscreen.e9e81b6d.js";import"./QBanner.958da182.js";function qe(q){const c=document.createElement("textarea");c.value=q,c.contentEditable="true",c.style.position="fixed";const i=()=>{};ve(i),document.body.appendChild(c),c.focus(),c.select();const b=document.execCommand("copy");return c.remove(),pe(i),b}function Ie(q){return navigator.clipboard!==void 0?navigator.clipboard.writeText(q):new Promise((c,i)=>{const b=qe(q);b?c(!0):i(b)})}const Ve={class:"row items-center justify-end"},Pe={key:0,class:"text-center q-my-xl"},Ye={key:2},Se={class:"text-h6 q-mb-md"},Ae={class:"full-width row flex-center text-primary q-gutter-sm"},Fe={class:"row q-col-gutter-md q-mb-md"},Be={class:"col-12 col-md-4"},Me={class:"text-h4 text-primary"},Ne={class:"col-12 col-md-4"},Ue={class:"text-h4 text-positive"},$e={class:"col-12 col-md-4"},je={class:"text-h4 text-negative"},Le={class:"row q-col-gutter-md"},Oe={class:"col-12 col-md-6"},Ke={class:"col-12 col-md-6"},ze={class:"full-width row flex-center text-primary q-gutter-sm"},Ee={key:0},Ge={key:1},He={class:"full-width row flex-center text-primary q-gutter-sm"},We={key:3,class:"text-center text-grey q-mt-xl"},ae="https://n8n.makexyz.site/webhook/c64cd118-30e9-4173-9c45-f803d728d043",Xe={__name:"AssignmentGradingStatusPage",setup(q){const c=Te(),i=s(""),b=s("");s("");const _=s(null),u=s(!1),f=s(""),P=s("ungraded"),v=w(()=>{var n;return((n=_.value)==null?void 0:n.assignment_by_status)||{}}),le=w(()=>{var n;return((n=_.value)==null?void 0:n.notgraded_submissions)||[]}),ne=w(()=>{var n;return((n=_.value)==null?void 0:n.assignment_by_user)||{}}),oe=w(()=>{var n;return((n=_.value)==null?void 0:n.grader_stats)||{}}),M=w(()=>v.value.notgraded_count||0),re=w(()=>Object.entries(ne.value).map(([n,e])=>({userId:parseInt(n),...e}))),se=w(()=>Object.entries(oe.value).map(([n,e])=>{var a;return{graderId:parseInt(n),fullName:((a=e.grader_info)==null?void 0:a.fullname)||`Grader ID ${n}`,...e}})),N=s(""),E=s({rowsPerPage:15,sortBy:"time_modified",descending:!0}),ie=s([{name:"module",label:"Assignment",field:"module_name",align:"left",sortable:!0},{name:"user",label:"Ng\u01B0\u1EDDi n\u1ED9p (ID)",field:"user_id",align:"center",sortable:!0},{name:"time_modified",label:"Th\u1EDDi gian n\u1ED9p",field:"time_modified",align:"center",sortable:!0},{name:"action",label:"H\xE0nh \u0111\u1ED9ng",field:"submission_link",align:"center",sortable:!1}]),U=s(""),G=s({rowsPerPage:10,sortBy:"notgraded_count",descending:!0}),de=s([{name:"userId",label:"User ID",field:"userId",align:"left",sortable:!0},{name:"graded_count",label:"\u0110\xE3 ch\u1EA5m",field:"graded_count",align:"center",sortable:!0},{name:"notgraded_count",label:"Ch\u01B0a ch\u1EA5m",field:"notgraded_count",align:"center",sortable:!0},{name:"total_count",label:"T\u1ED5ng c\u1ED9ng",field:"total_count",align:"center",sortable:!0}]),$=s(""),H=s({rowsPerPage:10,sortBy:"total_count",descending:!0}),ue=s([{name:"graderName",label:"T\xEAn Trainer",field:"fullName",align:"left",sortable:!0},{name:"total_count",label:"T\u1ED5ng b\xE0i \u0111\xE3 ch\u1EA5m",field:"total_count",align:"center",sortable:!0},{name:"details",label:"Chi ti\u1EBFt",field:"graderId",align:"center",sortable:!1}]),me=n=>n?V.formatDate(n*1e3,"DD/MM/YYYY HH:mm:ss"):"N/A",ce=n=>{if(!n)return!1;try{const e=JSON.parse(n);return Array.isArray(e)&&e.length>0}catch(e){return console.error("Error parsing submitted_files_json:",e),!1}},ge=n=>{if(!n)return;const e=n.replace(/<[^>]*>/g,`
`).replace(/\n+/g,`
`).trim();Ie(e).then(()=>{c.notify({message:"\u0110\xE3 sao ch\xE9p n\u1ED9i dung text v\xE0o clipboard.",color:"positive",icon:"check",position:"top"})}).catch(()=>{c.notify({message:"Kh\xF4ng th\u1EC3 sao ch\xE9p t\u1EF1 \u0111\u1ED9ng.",color:"negative",icon:"warning",position:"top"})})},W=()=>{const n=V.subtractFromDate(new Date,{days:7});i.value=V.formatDate(n,"YYYY-MM-DD"),b.value=V.formatDate(n,"DD/MM/YYYY")},fe=()=>{if(i.value){const n=i.value,e=V.formatDate(n,"DD/MM/YYYY");b.value=e,j()}},j=async(n=!1)=>{var e;if(!((u.value||!i.value)&&!n)){n&&!i.value&&W(),u.value=!0,f.value="";try{console.log(`Fetching data from ${ae} with fromDate=${i.value}`);const a=await De.get(ae,{params:{fromDate:i.value}});console.log("API Response:",a.data),a.data&&typeof a.data=="object"&&a.data.assignment_by_status?_.value=a.data:(console.error("API response format unexpected:",a.data),f.value="D\u1EEF li\u1EC7u nh\u1EADn \u0111\u01B0\u1EE3c kh\xF4ng h\u1EE3p l\u1EC7.",_.value=null)}catch(a){console.error("API Error:",a),_.value=null,a.response?f.value=`L\u1ED7i ${a.response.status}: ${((e=a.response.data)==null?void 0:e.message)||"Kh\xF4ng th\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u t\u1EEB m\xE1y ch\u1EE7."}`:a.request?f.value="Kh\xF4ng th\u1EC3 k\u1EBFt n\u1ED1i \u0111\u1EBFn m\xE1y ch\u1EE7. Vui l\xF2ng ki\u1EC3m tra m\u1EA1ng.":f.value="\u0110\xE3 x\u1EA3y ra l\u1ED7i trong qu\xE1 tr\xECnh t\u1EA3i d\u1EEF li\u1EC7u."}finally{u.value=!1}}};return be(()=>{W(),j()}),(n,e)=>(r(),x(we,{padding:""},{default:l(()=>[t(Q,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[t(D,null,{default:l(()=>e[12]||(e[12]=[o("div",{class:"text-h6"},"B\u1ED9 l\u1ECDc",-1)])),_:1}),t(Z),t(D,{class:"row items-center q-gutter-md"},{default:l(()=>[t(Y,{filled:"",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value=a),mask:"date",label:"L\u1ECDc b\xE0i n\u1ED9p t\u1EEB ng\xE0y",style:{"min-width":"200px"},disable:u.value,readonly:""},{append:l(()=>[t(y,{name:"event",class:"cursor-pointer"},{default:l(()=>[t(_e,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(ye,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),mask:"YYYY-MM-DD"},{default:l(()=>[o("div",Ve,[J(t(T,{label:"H\u1EE7y",color:"primary",flat:""},null,512),[[te]]),J(t(T,{label:"Ch\u1ECDn",color:"primary",flat:"",onClick:fe},null,512),[[te]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"]),t(T,{label:"L\xE0m m\u1EDBi",color:"primary",icon:"refresh",onClick:e[2]||(e[2]=a=>j(!0)),loading:u.value,disable:u.value},null,8,["loading","disable"])]),_:1})]),_:1}),u.value?(r(),h("div",Pe,[t(he,{color:"primary",size:"50px"}),t(I,{offset:[0,8]},{default:l(()=>e[13]||(e[13]=[p("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...")])),_:1})])):k("",!0),f.value&&!u.value?(r(),x(Qe,{key:1,message:f.value,onClose:e[3]||(e[3]=a=>f.value=""),class:"q-mb-md"},null,8,["message"])):k("",!0),_.value&&!u.value&&!f.value?(r(),h("div",Ye,[t(xe,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=a=>P.value=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:l(()=>[t(S,{name:"ungraded",label:"B\xE0i c\u1EA7n ch\u1EA5m",alert:M.value?"red":!1,"alert-tooltip":`${M.value} b\xE0i c\u1EA7n ch\u1EA5m`},null,8,["alert","alert-tooltip"]),t(S,{name:"overview",label:"T\u1ED5ng quan"}),t(S,{name:"by_user",label:"Theo \u1EE9ng vi\xEAn"}),t(S,{name:"by_grader",label:"Theo Trainer"})]),_:1},8,["modelValue"]),t(Z),t(ke,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=a=>P.value=a),animated:""},{default:l(()=>[t(A,{name:"ungraded"},{default:l(()=>[o("div",Se,"Danh s\xE1ch b\xE0i n\u1ED9p ch\u01B0a ch\u1EA5m ("+m(M.value)+")",1),t(K,{flat:"",bordered:"",rows:le.value,columns:ie.value,"row-key":"submission_id",loading:u.value,filter:N.value,pagination:E.value,"onUpdate:pagination":e[6]||(e[6]=a=>E.value=a)},{"top-right":l(()=>[t(Y,{borderless:"",dense:"",debounce:"300",modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=a=>N.value=a),placeholder:"T\xECm ki\u1EBFm..."},{append:l(()=>[t(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-time_modified":l(a=>[t(F,{props:a},{default:l(()=>[p(m(me(a.value)),1)]),_:2},1032,["props"])]),"body-cell-action":l(a=>[t(F,{props:a},{default:l(()=>[t(T,{flat:"",dense:"",round:"",color:"primary",icon:"grading",href:a.row.submission_link,target:"_blank","aria-label":"Ch\u1EA5m b\xE0i"},{default:l(()=>[t(I,null,{default:l(()=>e[14]||(e[14]=[p("\u0110\u1EBFn trang ch\u1EA5m b\xE0i")])),_:1})]),_:2},1032,["href"]),a.row.online_text?(r(),x(T,{key:0,flat:"",dense:"",round:"",color:"info",icon:"content_copy",onClick:d=>ge(a.row.online_text),class:"q-ml-sm"},{default:l(()=>[t(I,null,{default:l(()=>e[15]||(e[15]=[p("Copy n\u1ED9i dung text")])),_:1})]),_:2},1032,["onClick"])):k("",!0),ce(a.row.submitted_files_json)?(r(),x(y,{key:1,name:"attach_file",class:"q-ml-sm",color:"grey"},{default:l(()=>[t(I,null,{default:l(()=>e[16]||(e[16]=[p("C\xF3 file \u0111\xEDnh k\xE8m")])),_:1})]),_:1})):k("",!0)]),_:2},1032,["props"])]),"no-data":l(({icon:a,message:d,filter:g})=>[o("div",Ae,[t(y,{size:"2em",name:g?"filter_alt_off":a},null,8,["name"]),o("span",null,m(g?"Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3":d),1)])]),_:1},8,["rows","columns","loading","filter","pagination"])]),_:1}),t(A,{name:"overview"},{default:l(()=>[e[24]||(e[24]=o("div",{class:"text-h6 q-mb-md"},"T\u1ED5ng quan t\xECnh h\xECnh",-1)),o("div",Fe,[o("div",Be,[t(Q,{flat:"",bordered:""},{default:l(()=>[t(D,{class:"text-center"},{default:l(()=>[o("div",Me,m(v.value.total_count||0),1),e[17]||(e[17]=o("div",{class:"text-subtitle2 text-grey"},"T\u1ED5ng s\u1ED1 b\xE0i n\u1ED9p",-1))]),_:1})]),_:1})]),o("div",Ne,[t(Q,{flat:"",bordered:""},{default:l(()=>[t(D,{class:"text-center"},{default:l(()=>[o("div",Ue,m(v.value.graded_count||0),1),e[18]||(e[18]=o("div",{class:"text-subtitle2 text-grey"},"\u0110\xE3 ch\u1EA5m",-1))]),_:1})]),_:1})]),o("div",$e,[t(Q,{flat:"",bordered:""},{default:l(()=>[t(D,{class:"text-center"},{default:l(()=>[o("div",je,m(v.value.notgraded_count||0),1),e[19]||(e[19]=o("div",{class:"text-subtitle2 text-grey"},"Ch\u01B0a ch\u1EA5m",-1))]),_:1})]),_:1})])]),o("div",Le,[o("div",Oe,[t(Q,{flat:"",bordered:""},{default:l(()=>[t(D,{class:"bg-negative text-white"},{default:l(()=>e[20]||(e[20]=[o("div",{class:"text-h6"},"Assignment c\xF3 b\xE0i ch\u01B0a ch\u1EA5m",-1)])),_:1}),t(ee,{separator:""},{default:l(()=>[(r(!0),h(L,null,O(v.value.notgraded,(a,d)=>(r(),x(B,{key:d},{default:l(()=>[t(C,null,{default:l(()=>[t(R,null,{default:l(()=>[p(m(d),1)]),_:2},1024)]),_:2},1024),t(C,{side:""},{default:l(()=>[t(z,{color:"negative",label:a},null,8,["label"])]),_:2},1024)]),_:2},1024))),128)),!v.value.notgraded||Object.keys(v.value.notgraded).length===0?(r(),x(B,{key:0},{default:l(()=>[t(C,{class:"text-center text-grey"},{default:l(()=>e[21]||(e[21]=[p("Kh\xF4ng c\xF3")])),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),o("div",Ke,[t(Q,{flat:"",bordered:""},{default:l(()=>[t(D,{class:"bg-positive text-white"},{default:l(()=>e[22]||(e[22]=[o("div",{class:"text-h6"},"Assignment \u0111\xE3 ch\u1EA5m",-1)])),_:1}),t(ee,{separator:""},{default:l(()=>[(r(!0),h(L,null,O(v.value.graded,(a,d)=>(r(),x(B,{key:d},{default:l(()=>[t(C,null,{default:l(()=>[t(R,null,{default:l(()=>[p(m(d),1)]),_:2},1024)]),_:2},1024),t(C,{side:""},{default:l(()=>[t(z,{color:"positive",label:a},null,8,["label"])]),_:2},1024)]),_:2},1024))),128)),!v.value.graded||Object.keys(v.value.graded).length===0?(r(),x(B,{key:0},{default:l(()=>[t(C,{class:"text-center text-grey"},{default:l(()=>e[23]||(e[23]=[p("Ch\u01B0a c\xF3 b\xE0i n\xE0o \u0111\u01B0\u1EE3c ch\u1EA5m")])),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})])])]),_:1}),t(A,{name:"by_user"},{default:l(()=>[e[25]||(e[25]=o("div",{class:"text-h6 q-mb-md"},"Th\u1ED1ng k\xEA theo \u1EE9ng vi\xEAn",-1)),t(K,{flat:"",bordered:"",rows:re.value,columns:de.value,"row-key":"userId",loading:u.value,filter:U.value,pagination:G.value,"onUpdate:pagination":e[8]||(e[8]=a=>G.value=a)},{"top-right":l(()=>[t(Y,{borderless:"",dense:"",debounce:"300",modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),placeholder:"T\xECm User ID..."},{append:l(()=>[t(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-notgraded_count":l(a=>[t(F,{props:a},{default:l(()=>[t(z,{color:a.value>0?"negative":"grey-5",label:a.value},null,8,["color","label"])]),_:2},1032,["props"])]),"no-data":l(({icon:a,message:d,filter:g})=>[o("div",ze,[t(y,{size:"2em",name:g?"filter_alt_off":a},null,8,["name"]),o("span",null,m(g?"Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3":d),1)])]),_:1},8,["rows","columns","loading","filter","pagination"])]),_:1}),t(A,{name:"by_grader"},{default:l(()=>[e[27]||(e[27]=o("div",{class:"text-h6 q-mb-md"},"Th\u1ED1ng k\xEA theo Trainer ch\u1EA5m b\xE0i",-1)),t(K,{flat:"",bordered:"",rows:se.value,columns:ue.value,"row-key":"graderId",loading:u.value,filter:$.value,pagination:H.value,"onUpdate:pagination":e[10]||(e[10]=a=>H.value=a)},{"top-right":l(()=>[t(Y,{borderless:"",dense:"",debounce:"300",modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=a=>$.value=a),placeholder:"T\xECm Trainer..."},{append:l(()=>[t(y,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-details":l(a=>[t(F,{props:a},{default:l(()=>[t(T,{flat:"",dense:"",round:"",icon:"info",color:"primary"},{default:l(()=>[t(I,{"max-width":"400px"},{default:l(()=>[e[26]||(e[26]=o("div",{class:"text-weight-bold q-mb-sm"},"Chi ti\u1EBFt ch\u1EA5m b\xE0i:",-1)),a.row.assignment_graded_details&&Object.keys(a.row.assignment_graded_details).length>0?(r(),h("div",Ee,[(r(!0),h(L,null,O(a.row.assignment_graded_details,(d,g)=>{var X;return r(),h("div",{key:g,class:"q-mb-xs"},[o("strong",null,m(g)+":",1),p(" "+m(d.length)+" b\xE0i (Score TB: "+m(((X=a.row.average_score_details[g])==null?void 0:X.toFixed(2))||"N/A")+") ",1)])}),128))])):(r(),h("div",Ge,"Ch\u01B0a ch\u1EA5m b\xE0i n\xE0o trong kho\u1EA3ng th\u1EDDi gian n\xE0y."))]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"no-data":l(({icon:a,message:d,filter:g})=>[o("div",He,[t(y,{size:"2em",name:g?"filter_alt_off":a},null,8,["name"]),o("span",null,m(g?"Kh\xF4ng t\xECm th\u1EA5y k\u1EBFt qu\u1EA3":d),1)])]),_:1},8,["rows","columns","loading","filter","pagination"])]),_:1})]),_:1},8,["modelValue"])])):k("",!0),!_.value&&!u.value&&!f.value?(r(),h("div",We,[t(y,{name:"cloud_off",size:"lg"}),e[28]||(e[28]=o("p",null,'Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u. H\xE3y ch\u1ECDn ng\xE0y v\xE0 nh\u1EA5n "L\xE0m m\u1EDBi".',-1))])):k("",!0)]),_:1}))}};var Dt=Ce(Xe,[["__scopeId","data-v-ea5c3936"]]);export{Dt as default};
