import{r as h,o as j,X as _,Y as x,Z as u,q as d,ae as P,a7 as v,_ as w,a0 as N,a1 as b,ce as J,cf as X,a6 as B,ad as U,a9 as $,$ as T,aN as G}from"./index.037f850d.js";import{Q as q,a as z,b as ee}from"./QItem.a6e550b6.js";import{Q as te}from"./QSelect.70047d12.js";import{Q as ae}from"./QSpinnerDots.6c974946.js";import{Q as ne}from"./QTooltip.9f64b4d0.js";import{Q as se}from"./QBanner.958da182.js";import{a as le,Q as re}from"./QTable.3729fe60.js";import{Q as ie}from"./QPage.a2da79f2.js";import{a as S}from"./axios.9ab26c22.js";import{u as oe}from"./use-quasar.414eeb3f.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{t as A,m as Y,a as H,c as de,i as O,f as M}from"./format.65a92b22.js";import"./rtl.ad3ba425.js";import"./selection.b5503321.js";import"./format.8ac60962.js";import"./QList.80fe3cd0.js";import"./QMarkupTable.c24125e0.js";import"./QLinearProgress.f467e272.js";import"./use-fullscreen.e9e81b6d.js";function ce(a,e){var f;const t=()=>de(e==null?void 0:e.in,NaN),n=(f=e==null?void 0:e.additionalDigits)!=null?f:2,l=ge(a);let c;if(l.date){const i=he(l.date,n);c=ve(i.restDateString,i.year)}if(!c||isNaN(+c))return t();const p=+c;let g=0,m;if(l.time&&(g=ye(l.time),isNaN(g)))return t();if(l.timezone){if(m=_e(l.timezone),isNaN(m))return t()}else{const i=new Date(p+g),y=A(0,e==null?void 0:e.in);return y.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),y.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),y}return A(p+g+m,e==null?void 0:e.in)}const k={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},me=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,fe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,pe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ge(a){const e={},t=a.split(k.dateTimeDelimiter);let n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],k.timeZoneDelimiter.test(e.date)&&(e.date=a.split(k.timeZoneDelimiter)[0],n=a.substr(e.date.length,a.length))),n){const l=k.timezone.exec(n);l?(e.time=n.replace(l[1],""),e.timezone=l[1]):e.time=n}return e}function he(a,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=a.match(t);if(!n)return{year:NaN,restDateString:""};const l=n[1]?parseInt(n[1]):null,c=n[2]?parseInt(n[2]):null;return{year:c===null?l:c*100,restDateString:a.slice((n[1]||n[2]).length)}}function ve(a,e){if(e===null)return new Date(NaN);const t=a.match(me);if(!t)return new Date(NaN);const n=!!t[4],l=D(t[1]),c=D(t[2])-1,p=D(t[3]),g=D(t[4]),m=D(t[5])-1;if(n)return we(e,g,m)?be(e,g,m):new Date(NaN);{const f=new Date(0);return!De(e,c,p)||!xe(e,l)?new Date(NaN):(f.setUTCFullYear(e,c,Math.max(l,p)),f)}}function D(a){return a?parseInt(a):1}function ye(a){const e=a.match(fe);if(!e)return NaN;const t=C(e[1]),n=C(e[2]),l=C(e[3]);return Te(t,n,l)?t*Y+n*H+l*1e3:NaN}function C(a){return a&&parseFloat(a.replace(",","."))||0}function _e(a){if(a==="Z")return 0;const e=a.match(pe);if(!e)return 0;const t=e[1]==="+"?-1:1,n=parseInt(e[2]),l=e[3]&&parseInt(e[3])||0;return ke(n,l)?t*(n*Y+l*H):NaN}function be(a,e,t){const n=new Date(0);n.setUTCFullYear(a,0,4);const l=n.getUTCDay()||7,c=(e-1)*7+t+1-l;return n.setUTCDate(n.getUTCDate()+c),n}const Ne=[31,null,31,30,31,30,31,31,30,31,30,31];function F(a){return a%400===0||a%4===0&&a%100!==0}function De(a,e,t){return e>=0&&e<=11&&t>=1&&t<=(Ne[e]||(F(a)?29:28))}function xe(a,e){return e>=1&&e<=(F(a)?366:365)}function we(a,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function Te(a,e,t){return a===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&a>=0&&a<25}function ke(a,e){return e>=0&&e<=59}const Ce={class:"row q-col-gutter-md items-start"},Qe={class:"col-xs-12 col-sm-9 col-md-10"},Ie={class:"col-xs-12 col-sm-3 col-md-2"},Pe={key:0,class:"text-center q-my-xl"},Be={class:"text-subtitle1 text-primary"},Ue={class:"full-width row flex-center text-negative q-gutter-sm q-pa-md"},$e={key:3,class:"text-center text-grey q-mt-xl"},V="https://n8n.makexyz.site/webhook/8f957d58-9145-4a3b-80c3-b3f957689bfe",qe={__name:"BadgeSearchPage",setup(a){const e=oe(),t=h([]),n=h([]),l=h(null),c=h(null),p=h([]),g=h(!1),m=h(!1),f=h(!1),i=h(""),y=h({sortBy:"full_name",descending:!1,page:1,rowsPerPage:10}),L=h([{name:"employee_code",label:"M\xE3 NV",align:"left",field:"employee_code",sortable:!0},{name:"full_name",label:"H\u1ECD v\xE0 T\xEAn",align:"left",field:"full_name",sortable:!0,style:"min-width: 180px;"},{name:"department_id",label:"Ph\xF2ng Ban",align:"left",field:"department_id",sortable:!0,style:"min-width: 250px; white-space: normal;"},{name:"bagdedateissued",label:"Ng\xE0y C\u1EA5p",align:"center",field:"bagdedateissued",sortable:!0,format:s=>I(s),style:"min-width: 150px;"}]),E=async()=>{m.value=!0,i.value="",t.value=[],n.value=[];try{const s=await S.get(V,{params:{badgeNameList:!0}});Array.isArray(s.data)?(t.value=s.data.map(r=>r.badgename).filter(r=>r),n.value=[...t.value]):(console.error("API response for badge names is not an array:",s.data),i.value="\u0110\u1ECBnh d\u1EA1ng d\u1EEF li\u1EC7u danh s\xE1ch huy hi\u1EC7u kh\xF4ng h\u1EE3p l\u1EC7.")}catch(s){console.error("API Error fetching badge names:",s),Q(s,"Kh\xF4ng th\u1EC3 t\u1EA3i danh s\xE1ch huy hi\u1EC7u.")}finally{m.value=!1}},R=(s,r,o)=>{if(!t.value||t.value.length===0){o();return}r(()=>{const K=s.toLowerCase();n.value=t.value.filter(W=>W.toLowerCase().includes(K))})},Z=async()=>{if(!l.value){e.notify({type:"warning",message:"Vui l\xF2ng ch\u1ECDn m\u1ED9t huy hi\u1EC7u \u0111\u1EC3 t\xECm ki\u1EBFm."});return}f.value=!0,g.value=!0,c.value=l.value,i.value="",p.value=[];try{const s=await S.get(V,{params:{badgeSearch:l.value}});Array.isArray(s.data)?(p.value=s.data,y.value.page=1):s.data&&typeof s.data=="object"&&Object.keys(s.data).length===0?p.value=[]:(console.error("API response for employee search is not an array:",s.data),i.value="\u0110\u1ECBnh d\u1EA1ng d\u1EEF li\u1EC7u danh s\xE1ch nh\xE2n vi\xEAn kh\xF4ng h\u1EE3p l\u1EC7.",p.value=[])}catch(s){console.error("API Error searching employees:",s),Q(s,`Kh\xF4ng th\u1EC3 t\xECm ki\u1EBFm nh\xE2n vi\xEAn cho huy hi\u1EC7u '${l.value}'.`),p.value=[]}finally{f.value=!1}},Q=(s,r)=>{var o;s.response?i.value=`L\u1ED7i ${s.response.status}: ${r} ${((o=s.response.data)==null?void 0:o.message)||""}`:s.request?i.value=`Kh\xF4ng th\u1EC3 k\u1EBFt n\u1ED1i \u0111\u1EBFn m\xE1y ch\u1EE7. Vui l\xF2ng ki\u1EC3m tra m\u1EA1ng v\xE0 th\u1EED l\u1EA1i. (${r})`:i.value=`\u0110\xE3 x\u1EA3y ra l\u1ED7i: ${s.message||r}`},I=s=>{if(!s)return"N/A";try{const r=ce(s.replace(" ","T"));if(O(r))return M(r,"dd/MM/yyyy HH:mm");{const o=new Date(s);return O(o)?M(o,"dd/MM/yyyy HH:mm"):s}}catch(r){return console.warn("Could not format date:",s,r),s}};return j(()=>{E()}),(s,r)=>(_(),x(ie,{padding:""},{default:u(()=>[d(U,{flat:"",bordered:"",class:"q-mb-md"},{default:u(()=>[d(P,null,{default:u(()=>[v("div",Ce,[v("div",Qe,[d(te,{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=o=>l.value=o),label:"Ch\u1ECDn ho\u1EB7c nh\u1EADp t\xEAn Huy hi\u1EC7u \u0111\u1EC3 l\u1ECDc",outlined:"",dense:"","use-input":"","hide-selected":"","fill-input":"","input-debounce":"300",options:n.value,onFilter:R,loading:m.value,disable:m.value||f.value,clearable:"",onClear:r[1]||(r[1]=o=>l.value=null),"options-dense":""},{prepend:u(()=>[d(w,{name:"badge"})]),"no-option":u(()=>[d(q,null,{default:u(()=>[d(z,{class:"text-grey"},{default:u(()=>[N(b(m.value?"\u0110ang t\u1EA3i danh s\xE1ch...":"Kh\xF4ng t\xECm th\u1EA5y huy hi\u1EC7u"),1)]),_:1})]),_:1})]),option:u(o=>[d(q,J(X(o.itemProps)),{default:u(()=>[d(z,null,{default:u(()=>[d(ee,null,{default:u(()=>[N(b(o.opt),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading","disable"])]),v("div",Ie,[d(B,{label:"T\xECm ki\u1EBFm",color:"primary",icon:"search",onClick:Z,loading:f.value,disable:!l.value||f.value||m.value,class:"full-width"},null,8,["loading","disable"])])])]),_:1})]),_:1}),f.value||m.value?(_(),$("div",Pe,[d(ae,{color:"primary",size:"50px"}),d(ne,{offset:[0,8]},{default:u(()=>r[4]||(r[4]=[N("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...")])),_:1})])):T("",!0),i.value?(_(),x(se,{key:1,"inline-actions":"",class:"text-white bg-negative q-mb-md rounded-borders"},{avatar:u(()=>[d(w,{name:"error",color:"white"})]),action:u(()=>[d(B,{flat:"",color:"white",label:"\u0110\xF3ng",onClick:r[2]||(r[2]=o=>i.value=""),dense:""})]),default:u(()=>[N(" "+b(i.value)+" ",1)]),_:1})):T("",!0),g.value&&!f.value&&!i.value?(_(),x(U,{key:2,flat:"",bordered:""},{default:u(()=>[d(P,{class:"q-pb-none"},{default:u(()=>[r[5]||(r[5]=v("div",{class:"text-h6"},"K\u1EBFt qu\u1EA3 t\xECm ki\u1EBFm cho huy hi\u1EC7u:",-1)),v("div",Be,b(c.value||"N/A"),1)]),_:1}),p.value.length>0?(_(),x(G,{key:0,inset:""})):T("",!0),d(re,{rows:p.value,columns:L.value,"row-key":"dtnb_user_id",flat:"",dense:"",pagination:y.value,"onUpdate:pagination":r[3]||(r[3]=o=>y.value=o),"rows-per-page-options":[10,25,50,0],"wrap-cells":"",loading:f.value,"no-data-label":`Kh\xF4ng t\xECm th\u1EA5y gi\xE1o vi\xEAn n\xE0o c\xF3 huy hi\u1EC7u '${c.value}'.`,separator:"horizontal",class:"q-mt-sm"},{"body-cell-bagdedateissued":u(o=>[d(le,{props:o},{default:u(()=>[N(b(I(o.value)),1)]),_:2},1032,["props"])]),"no-data":u(({message:o})=>[v("div",Ue,[d(w,{size:"2em",name:"sentiment_dissatisfied"}),v("span",null,b(o),1)])]),_:1},8,["rows","columns","pagination","loading","no-data-label"])]),_:1})):!g.value&&!f.value&&!m.value&&!i.value?(_(),$("div",$e,[d(w,{name:"person_search",size:"lg"}),r[6]||(r[6]=v("p",null,'Ch\u1ECDn m\u1ED9t huy hi\u1EC7u v\xE0 nh\u1EA5n "T\xECm ki\u1EBFm" \u0111\u1EC3 xem danh s\xE1ch gi\xE1o vi\xEAn.',-1))])):T("",!0)]),_:1}))}};var et=ue(qe,[["__scopeId","data-v-597724ef"]]);export{et as default};
