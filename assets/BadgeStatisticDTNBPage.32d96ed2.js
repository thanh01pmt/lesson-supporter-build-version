import{h as we,a4 as Me,X as c,Y as k,r as v,k as ae,o as Ie,Z as a,q as e,ae as I,a7 as d,bs as he,_ as L,L as ne,a6 as O,ad as F,a9 as B,a0 as _,$,a1 as x,aN as Y,F as H,aa as oe,br as $e,ac as Ne}from"./index.037f850d.js";import{Q as ye,a as ve}from"./QPopupProxy.aac1ad86.js";import{Q as Se}from"./QSpinnerDots.6c974946.js";import{Q as be}from"./QTooltip.9f64b4d0.js";import{Q as Ve}from"./QBanner.958da182.js";import{Q as Ae,b as _e,a as T}from"./QTable.3729fe60.js";import{Q as U}from"./QTr.671570e6.js";import{Q as Le}from"./QBadge.c4b03a0c.js";import{Q as Pe}from"./QSpace.8ac92afd.js";import{Q as Ee,a as je,b as ze}from"./QItem.a6e550b6.js";import{Q as Ke}from"./QList.80fe3cd0.js";import{Q as Fe}from"./QPage.a2da79f2.js";import{C as se}from"./ClosePopup.f7b4fda5.js";import{a as Ye}from"./axios.9ab26c22.js";import{g as E,p as q,i as He}from"./get-css-var.57a0da59.js";import{u as Ue}from"./use-quasar.414eeb3f.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{t as R,c as xe,f as P,i as le}from"./format.65a92b22.js";import"./use-render-cache.3aae9b27.js";import"./date.3d27e200.js";import"./format.8ac60962.js";import"./QSelect.70047d12.js";import"./rtl.ad3ba425.js";import"./selection.b5503321.js";import"./QMarkupTable.c24125e0.js";import"./QLinearProgress.f467e272.js";import"./use-fullscreen.e9e81b6d.js";function Re(m,g,s){const r=R(m,s==null?void 0:s.in);if(isNaN(g))return xe((s==null?void 0:s.in)||m,NaN);if(!g)return r;const p=r.getDate(),f=xe((s==null?void 0:s.in)||m,r.getTime());f.setMonth(r.getMonth()+g+1,0);const b=f.getDate();return p>=b?f:(r.setFullYear(f.getFullYear(),f.getMonth(),p),r)}function Je(m,g){const s=+R(m)-+R(g);return s<0?-1:s>0?1:s}function Xe(m,g){const s=R(m,g==null?void 0:g.in);return s.setDate(1),s.setHours(0,0,0,0),s}function Ge(m,g,s){return Re(m,-g,s)}const Ze=we({name:"ApexLine",data(){return{options:{title:{text:"ApexLine",align:"left"},chart:{id:"apex-line"},colors:[E("primary"),E("secondary"),E("negative")],markers:{size:4,hover:{sizeOffset:6}},xaxis:{categories:[1991,1992,1993,1994,1995,1996,1997,1998]}},series:[{name:"series-1",data:[30,40,45,50,49,60,70,91]}]}}});function We(m,g,s,r,p,f){const b=Me("apexchart");return c(),k(b,{height:"300",type:"line",options:m.options,series:m.series},null,8,["options","series"])}var et=re(Ze,[["render",We]]);const tt=we({name:"ApexDonut",props:{chartData:{type:Array,required:!0,default:()=>[]},options:{type:Object,required:!0,default:()=>{}}},data(){return{}}});function at(m,g,s,r,p,f){const b=Me("apexchart");return c(),k(b,{height:"300",type:"donut",options:m.options,series:m.chartData},null,8,["options","series"])}var nt=re(tt,[["render",at]]);const ot={class:"row q-col-gutter-md items-end"},st={class:"col-xs-12 col-sm-5"},lt={class:"row items-center justify-end"},rt={class:"col-xs-12 col-sm-5"},it={class:"row items-center justify-end"},ut={class:"col-xs-12 col-sm-2"},dt={key:0,class:"text-center q-my-xl"},ct={key:2},mt={class:"text-subtitle2"},gt={class:"row q-col-gutter-md"},ft={class:"col-xs-12 col-md-6"},pt={class:"col-xs-12 col-md-6"},ht={class:"text-weight-medium"},yt={class:"full-width row flex-center text-accent q-gutter-sm"},vt={key:3,class:"text-center text-grey q-mt-xl"},bt={class:"text-subtitle2 q-mb-sm"},_t={key:1,class:"text-grey"},xt="https://n8n.makexyz.site/webhook/8f957d58-9145-4a3b-80c3-b3f957689bfe",wt={__name:"BadgeStatisticDTNBPage",setup(m){const g=Ue(),s=new Date,r=v(P(Xe(Ge(s,1)),"yyyy-MM-dd")),p=v(P(s,"yyyy-MM-dd")),f=v(null),b=v([]),w=v(!1),M=v(""),J=v(!1),X=v([]),ie=v(""),ue=v({sortBy:"month",descending:!1,page:1,rowsPerPage:0}),j=v([]),de=v({}),N=v([]),G=v({}),ke=v([{name:"month",label:"Th\xE1ng C\u1EA5p",align:"left",field:"month",sortable:!0},{name:"totalBadgesInMonth",label:"T\u1ED5ng S\u1ED1 Huy hi\u1EC7u",align:"center",field:"totalBadgesInMonth",sortable:!0},{name:"uniqueBadgeTypesInMonth",label:"S\u1ED1 Lo\u1EA1i Huy hi\u1EC7u",align:"center",field:"uniqueBadgeTypesInMonth",sortable:!0}]),De=ae(()=>!w.value&&b.value.length>0),Z=ae(()=>r.value?P(q(r.value,"yyyy-MM-dd",new Date),"dd/MM/yyyy"):""),W=ae(()=>p.value?P(q(p.value,"yyyy-MM-dd",new Date),"dd/MM/yyyy"):""),Te=h=>p.value?h<=p.value.replace(/-/g,"/"):!0,Be=h=>r.value?h>=r.value.replace(/-/g,"/"):!0,ce=h=>{if(!h)return null;try{const t=q(h,"yyyy-MM-dd",new Date);return le(t)?P(t,"yyyyMMdd"):null}catch(t){return console.error("Error parsing date for API:",t),null}},me=async()=>{var Q;if(!r.value||!p.value){g.notify({type:"negative",message:"Vui l\xF2ng ch\u1ECDn ng\xE0y b\u1EAFt \u0111\u1EA7u v\xE0 k\u1EBFt th\xFAc."});return}const h=q(r.value,"yyyy-MM-dd",new Date),t=q(p.value,"yyyy-MM-dd",new Date);if(le(h)&&le(t)&&He(h,t)){g.notify({type:"negative",message:"Ng\xE0y b\u1EAFt \u0111\u1EA7u kh\xF4ng \u0111\u01B0\u1EE3c sau ng\xE0y k\u1EBFt th\xFAc."});return}w.value=!0,M.value="",f.value=null,b.value=[],j.value=[],N.value=[];const n=ce(r.value),l=ce(p.value);if(!n||!l){M.value="\u0110\u1ECBnh d\u1EA1ng ng\xE0y kh\xF4ng h\u1EE3p l\u1EC7.",w.value=!1;return}try{const i=await Ye.get(xt,{params:{startDate:n,endDate:l}});i.data&&typeof i.data=="object"&&Object.keys(i.data).length>0?(f.value=i.data,console.log("Actual API Response:",f.value)):i.data&&typeof i.data=="object"&&Object.keys(i.data).length===0?(f.value={},console.log("API returned empty data for the period.")):(console.error("API response format unexpected:",i.data),M.value="D\u1EEF li\u1EC7u nh\u1EADn \u0111\u01B0\u1EE3c kh\xF4ng h\u1EE3p l\u1EC7 ho\u1EB7c kh\xF4ng c\xF3 d\u1EEF li\u1EC7u.",f.value=null),f.value&&Qe(f.value)}catch(i){console.error("API Error:",i),i.response?M.value=`L\u1ED7i ${i.response.status}: Kh\xF4ng th\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u. ${((Q=i.response.data)==null?void 0:Q.message)||"Vui l\xF2ng th\u1EED l\u1EA1i."}`:i.request?M.value="Kh\xF4ng th\u1EC3 k\u1EBFt n\u1ED1i \u0111\u1EBFn m\xE1y ch\u1EE7. Vui l\xF2ng ki\u1EC3m tra m\u1EA1ng.":M.value="\u0110\xE3 x\u1EA3y ra l\u1ED7i trong qu\xE1 tr\xECnh t\u1EA3i d\u1EEF li\u1EC7u.",f.value=null,b.value=[],j.value=[],N.value=[]}finally{w.value=!1}},Qe=h=>{const t={},n={};let l=0;const Q=Object.keys(h).sort((o,u)=>Je(q(o,"yyyy-MM",new Date),q(u,"yyyy-MM",new Date)));for(const o of Q){if(!/^\d{4}-\d{2}$/.test(o))continue;const u=h[o];if(!!Array.isArray(u)){t[o]||(t[o]={month:o,totalBadgesInMonth:0,uniqueBadgeTypes:new Set,badges:[]});for(const y of u){if(typeof y!="object"||y===null)continue;const D=Object.keys(y)[0];if(!D)continue;const A=y[D];if(typeof A!="object"||A===null||typeof A.countOfBadgename!="number")continue;const te=A.countOfBadgename,qe=A.receiverEmails||[];t[o].totalBadgesInMonth+=te,t[o].uniqueBadgeTypes.add(D),t[o].badges.push({detailKey:`detail-${o}-${l++}`,badgeName:D,countOfBadgename:te,receiverEmails:qe}),n[D]=(n[D]||0)+te}}}b.value=Object.values(t).map(o=>({...o,uniqueBadgeTypesInMonth:o.uniqueBadgeTypes.size})),console.log("Monthly Grouped Data:",b.value);const i={};b.value.forEach(o=>{i[o.month]=o.totalBadgesInMonth});const ee=Object.keys(i),ge=ee.map(o=>i[o]);console.log("Calculated Line Categories:",JSON.stringify(ee)),console.log("Calculated Line Series Data:",JSON.stringify(ge));const fe={chart:{id:"badge-trend-line",toolbar:{show:!0},zoom:{enabled:!0},animations:{enabled:!0}},title:{text:"T\u1ED5ng S\u1ED1 Huy hi\u1EC7u C\u1EA5p Theo Th\xE1ng",align:"left"},colors:[E("primary")||"#1976D2"],markers:{size:4,hover:{sizeOffset:6}},xaxis:{categories:ee,title:{text:"Th\xE1ng"},labels:{rotate:-45,rotateAlways:!1,hideOverlappingLabels:!0}},yaxis:{title:{text:"T\u1ED5ng S\u1ED1 Huy hi\u1EC7u"},labels:{formatter:function(o){return o.toFixed(0)}},min:0},stroke:{curve:"smooth",width:2},tooltip:{y:{formatter:o=>`${o!==void 0?o.toFixed(0):0} huy hi\u1EC7u`},x:{format:"MMM yyyy"}},grid:{borderColor:"#f1f1f1"}},pe=[{name:"T\u1ED5ng Huy hi\u1EC7u",data:ge}];console.log("Assigning Line Options:",JSON.stringify(fe)),console.log("Assigning Line Series:",JSON.stringify(pe)),de.value=fe,j.value=pe;const S=6,C=Object.entries(n).sort(([,o],[,u])=>u-o);let V=[],z=[],K=0;if(C.length>S){const o=C.slice(0,S),u=C.slice(S);V=o.map(([y])=>y),z=o.map(([,y])=>y),K=u.reduce((y,[,D])=>y+D,0),K>0&&(V.push("Kh\xE1c"),z.push(K))}else V=C.map(([o])=>o),z=C.map(([,o])=>o);const Oe=V.map((o,u)=>{const y=["primary","secondary","accent","positive","negative","info","warning","deep-purple-6","light-green-6","orange-6"];return E(y[u%y.length])||`#${Math.floor(Math.random()*16777215).toString(16)}`});G.value={chart:{id:"badge-distribution-donut",toolbar:{show:!0}},title:{text:`Ph\xE2n B\u1ED1 Huy hi\u1EC7u T\u1ED5ng (${S>C.length?C.length:S}${K>0?" & Kh\xE1c":""})`,align:"left"},labels:V,colors:Oe,dataLabels:{enabled:!0,formatter:(o,u)=>u.w.config.series[u.seriesIndex]>0?`${o.toFixed(0)}%`:""},legend:{position:"bottom",formatter:(o,u)=>`${o}: ${u.w.globals.series[u.seriesIndex]}`},tooltip:{y:{formatter:o=>`${o} huy hi\u1EC7u`}},plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"T\u1ED5ng c\u1ED9ng",formatter:o=>o.globals.seriesTotals.reduce((u,y)=>u+y,0)}}}}}},N.value=z,console.log("Chart Donut Data:",N.value,G.value)},Ce=(h,t)=>{X.value=h||[],ie.value=t||"Kh\xF4ng r\xF5 t\xEAn",J.value=!0};return Ie(()=>{me()}),(h,t)=>(c(),k(Fe,{padding:""},{default:a(()=>[e(F,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(I,null,{default:a(()=>[d("div",ot,[d("div",st,[e(he,{modelValue:Z.value,"onUpdate:modelValue":t[1]||(t[1]=n=>Z.value=n),label:"T\u1EEB ng\xE0y",outlined:"",dense:"",readonly:"",disable:w.value},{append:a(()=>[e(L,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(ye,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ve,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),mask:"YYYY-MM-DD",options:Te,"today-btn":""},{default:a(()=>[d("div",lt,[ne(e(O,{label:"Ch\u1ECDn",color:"primary",flat:""},null,512),[[se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),d("div",rt,[e(he,{modelValue:W.value,"onUpdate:modelValue":t[3]||(t[3]=n=>W.value=n),label:"\u0110\u1EBFn ng\xE0y",outlined:"",dense:"",readonly:"",disable:w.value},{append:a(()=>[e(L,{name:"event",class:"cursor-pointer"},{default:a(()=>[e(ye,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(ve,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=n=>p.value=n),mask:"YYYY-MM-DD",options:Be,"today-btn":""},{default:a(()=>[d("div",it,[ne(e(O,{label:"Ch\u1ECDn",color:"primary",flat:""},null,512),[[se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])]),d("div",ut,[e(O,{label:"Xem Th\u1ED1ng K\xEA",color:"primary",icon:"bar_chart",onClick:me,loading:w.value,disable:!r.value||!p.value||w.value,class:"full-width"},null,8,["loading","disable"])])])]),_:1})]),_:1}),w.value?(c(),B("div",dt,[e(Se,{color:"primary",size:"50px"}),e(be,{offset:[0,8]},{default:a(()=>t[7]||(t[7]=[_("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...")])),_:1})])):$("",!0),M.value?(c(),k(Ve,{key:1,"inline-actions":"",class:"text-white bg-negative q-mb-md rounded-borders"},{avatar:a(()=>[e(L,{name:"error",color:"white"})]),action:a(()=>[e(O,{flat:"",color:"white",label:"\u0110\xF3ng",onClick:t[4]||(t[4]=n=>M.value=""),dense:""})]),default:a(()=>[_(" "+x(M.value)+" ",1)]),_:1})):$("",!0),De.value&&!w.value&&!M.value?(c(),B("div",ct,[e(F,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(I,null,{default:a(()=>[t[8]||(t[8]=d("div",{class:"text-h6"},"Bi\u1EC3u \u0111\u1ED3 Th\u1ED1ng k\xEA Huy hi\u1EC7u",-1)),d("div",mt," Trong kho\u1EA3ng th\u1EDDi gian: "+x(Z.value)+" - "+x(W.value),1)]),_:1}),e(Y),e(I,null,{default:a(()=>[d("div",gt,[d("div",ft,[e(et,{height:"450",series:j.value,options:de.value},null,8,["series","options"])]),d("div",pt,[e(nt,{height:"450",series:N.value,options:G.value},null,8,["series","options"])])])]),_:1})]),_:1}),e(F,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(I,null,{default:a(()=>t[9]||(t[9]=[d("div",{class:"text-h6"},"Chi Ti\u1EBFt C\u1EA5p Ph\xE1t Huy hi\u1EC7u Theo Th\xE1ng",-1)])),_:1}),e(Y),e(Ae,{rows:b.value,columns:ke.value,"row-key":"month",flat:"",dense:"",pagination:ue.value,"onUpdate:pagination":t[5]||(t[5]=n=>ue.value=n),"rows-per-page-options":[0],"hide-pagination":"","wrap-cells":"","no-data-label":"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u huy hi\u1EC7u trong kho\u1EA3ng th\u1EDDi gian \u0111\xE3 ch\u1ECDn.",loading:w.value,separator:"horizontal"},{header:a(n=>[e(U,{props:n},{default:a(()=>[e(_e,{"auto-width":""}),(c(!0),B(H,null,oe(n.cols,l=>(c(),k(_e,{key:l.name,props:n,class:"text-weight-bold"},{default:a(()=>[_(x(l.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:a(n=>[e(U,{props:n,class:"cursor-pointer",onClick:l=>n.expand=!n.expand},{default:a(()=>[e(T,{"auto-width":"",class:"text-center"},{default:a(()=>[e(O,{size:"sm",color:n.expand?"grey":"accent",round:"",dense:"",icon:n.expand?"remove":"add"},null,8,["color","icon"])]),_:2},1024),e(T,{key:"month",props:n},{default:a(()=>[d("span",ht,x(n.row.month),1)]),_:2},1032,["props"]),e(T,{key:"totalBadgesInMonth",props:n,class:"text-center"},{default:a(()=>[_(x(n.row.totalBadgesInMonth),1)]),_:2},1032,["props"]),e(T,{key:"uniqueBadgeTypesInMonth",props:n,class:"text-center"},{default:a(()=>[_(x(n.row.uniqueBadgeTypesInMonth),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"]),n.expand?(c(),B(H,{key:0},[(c(!0),B(H,null,oe(n.row.badges,l=>(c(),k(U,{key:l.detailKey,class:"bg-grey-1"},{default:a(()=>[e(T,{"auto-width":""}),e(T,{key:"badgeName"},{default:a(()=>[_(x(l.badgeName),1)]),_:2},1024),e(T,{key:"count",class:"text-center"},{default:a(()=>[_(x(l.countOfBadgename),1)]),_:2},1024),e(T,{key:"actions",class:"text-center"},{default:a(()=>[l.receiverEmails&&l.receiverEmails.length>0?(c(),k(O,{key:0,flat:"",round:"",dense:"",color:"info",icon:"visibility",size:"sm",onClick:$e(Q=>Ce(l.receiverEmails,l.badgeName),["stop"])},{default:a(()=>[e(Le,{color:"info",floating:"",transparent:""},{default:a(()=>[_(x(l.receiverEmails.length),1)]),_:2},1024),e(be,null,{default:a(()=>t[10]||(t[10]=[_("Xem danh s\xE1ch")])),_:1})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024)]),_:2},1024))),128)),n.row.badges&&n.row.badges.length>0?(c(),k(U,{key:0},{default:a(()=>[e(T,{colspan:"100%",class:"q-pa-none"},{default:a(()=>[e(Y)]),_:1})]),_:1})):$("",!0)],64)):$("",!0)]),"no-data":a(({icon:n,message:l,filter:Q})=>[d("div",yt,[e(L,{size:"2em",name:Q?"filter_b_and_w":n},null,8,["name"]),d("span",null,x(l),1)])]),_:1},8,["rows","columns","pagination","loading"])]),_:1})])):!w.value&&!M.value?(c(),B("div",vt,[e(L,{name:"query_stats",size:"lg"}),t[11]||(t[11]=d("p",null,'Ch\u1ECDn kho\u1EA3ng th\u1EDDi gian v\xE0 nh\u1EA5n "Xem Th\u1ED1ng K\xEA" \u0111\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u.',-1))])):$("",!0),e(Ne,{modelValue:J.value,"onUpdate:modelValue":t[6]||(t[6]=n=>J.value=n)},{default:a(()=>[e(F,{style:{"min-width":"350px"}},{default:a(()=>[e(I,{class:"row items-center q-pb-none"},{default:a(()=>[t[12]||(t[12]=d("div",{class:"text-h6"},"Danh s\xE1ch ng\u01B0\u1EDDi nh\u1EADn",-1)),t[13]||(t[13]=_()),e(Pe),t[14]||(t[14]=_()),ne(e(O,{icon:"close",flat:"",round:"",dense:""},null,512),[[se]])]),_:1}),e(I,{class:"q-pt-none"},{default:a(()=>[d("div",bt,x(ie.value),1),t[15]||(t[15]=_()),e(Y,{class:"q-mb-sm"}),X.value.length>0?(c(),k(Ke,{key:0,dense:"",bordered:"",padding:"",separator:""},{default:a(()=>[(c(!0),B(H,null,oe(X.value,(n,l)=>(c(),k(Ee,{key:l},{default:a(()=>[e(je,null,{default:a(()=>[e(ze,null,{default:a(()=>[_(x(n),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(c(),B("div",_t,"Kh\xF4ng c\xF3 th\xF4ng tin ng\u01B0\u1EDDi nh\u1EADn."))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};var Xt=re(wt,[["__scopeId","data-v-18075077"]]);export{Xt as default};
